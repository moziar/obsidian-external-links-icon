import { Plugin, PluginSettingTab, Setting, App, Modal, Notice } from 'obsidian';

/**
 * Sanitize SVG content: remove XML prolog/doctype, script/style tags,
 * ensure xmlns, and add viewBox if width/height present.
 */
function sanitizeSvg(svg: string): string {
	let s = svg.trim();
	// remove xml prolog and doctype
	s = s.replace(/<\?xml[\s\S]*?\?>/i, '');
	s = s.replace(/<!DOCTYPE[\s\S]*?>/i, '');
	// remove script/style
	s = s.replace(/<script[\s\S]*?<\/script>/gi, '');
	s = s.replace(/<style[\s\S]*?<\/style>/gi, '');
	// ensure xmlns
	if (!/<svg[^>]*xmlns=/.test(s)) {
		s = s.replace(/<svg/, '<svg xmlns="http://www.w3.org/2000/svg"');
	}
	// ensure viewBox if possible
	const svgTagMatch = s.match(/<svg([^>]*)>/);
	if (svgTagMatch) {
		const attrs = svgTagMatch[1];
		if (!/viewBox=/i.test(attrs)) {
			const widthMatch = attrs.match(/width=["']?([0-9.]+)(px)?["']?/i);
			const heightMatch = attrs.match(/height=["']?([0-9.]+)(px)?["']?/i);
			if (widthMatch && heightMatch) {
				const w = parseFloat(widthMatch[1]);
				const h = parseFloat(heightMatch[1]);
				s = s.replace(/<svg([^>]*)>/, `<svg$1 viewBox="0 0 ${w} ${h}">`);
			}
		}
	}
	return s;
}

/**
 * Prepare SVG for Settings preview.
 * - sanitize first
 * - replace `currentColor` with the computed color of the container
 * - replace `var(--name)` with the computed value of that CSS variable if available
 */
function prepareSvgForSettings(svg: string, container: HTMLElement): string {
    let s = sanitizeSvg(svg);
    try {
		// Remove embedded media queries that react to system prefers-color-scheme
		// so Settings preview follows Obsidian's explicit theme classes instead
		// of the host OS preference which may be different.
		s = s.replace(/@media\s*\(prefers-color-scheme:\s*dark\)\s*\{[\s\S]*?\}/gi, '');

        const comp = window.getComputedStyle(container);
        const color = comp && comp.color ? comp.color.trim() : '';

        if (color) {
            // replace occurrences of currentColor in attributes and inline styles
            s = s.replace(/currentColor/g, color);
        }

        // replace CSS variables used inside svg e.g. var(--accent)
        s = s.replace(/var\(--([a-zA-Z0-9-_]+)\)/g, (m, varName) => {
            // look up on container first, then documentElement
            const val1 = window.getComputedStyle(container).getPropertyValue(`--${varName}`) || '';
            const val2 = window.getComputedStyle(document.documentElement).getPropertyValue(`--${varName}`) || '';
            const val = (val1 || val2).trim();
            return val || m;
        });
    } catch (e) {
        // ignore
    }
    return s;
}

/**
 * Helper: determine whether we should prefer dark theme for settings previews.
 * Priority:
 * 1. If body has explicit `theme-dark` or `theme-light` class, use that.
 * 2. Otherwise fall back to `prefers-color-scheme` media query.
 */
function preferDarkThemeFromDocument(): boolean {
	const body = document.body;
	const isDarkByClass = body && body.classList ? body.classList.contains('theme-dark') : false;
	const isLightByClass = body && body.classList ? body.classList.contains('theme-light') : false;
	if (isDarkByClass) return true;
	if (isLightByClass) return false;
	return !!(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);
}

// 图标类型定义
type LinkType = 'url' | 'scheme';

interface IconItem {
	name: string;
	svgData: string;
	order: number;
	linkType: LinkType;
	themeDarkSvgData?: string;
	// target stores website domain (e.g. "baidu.com") or scheme identifier (e.g. "bear")
	target?: string;
}

interface ExternalLinksIconSettings {
	icons: Record<string, IconItem>;
	customIcons: Record<string, IconItem>;
}

// 特殊图标配置类型
interface SpecialIconConfig {
	selector: string;
}

// 图标分类类型
interface IconCategories {
	URL_SCHEME: readonly string[];
	WEB: Record<string, string>;
	SPECIAL: Record<string, SpecialIconConfig>;
}

// 图标分类配置常量
const ICON_CATEGORIES: IconCategories = {
	// URL Scheme 类型图标
	URL_SCHEME: [
		'goodlinks', 'zotero', 'snippetslab', 'siyuan', 'eagle', 
		'bear', 'prodrafts', 'things', 'shortcut', 'file'
	] as const,
	
	// Web 域名图标映射
	WEB: {
		'github': 'github.com',
		'sspai': 'sspai.com',
		'mp.weixin.qq': 'mp.weixin.qq.com',  // 修复拼写错误
		'xiaoyuzhoufm': 'xiaoyuzhoufm.com',
		'douban': 'douban.com',
		'bilibili': 'bilibili.com',
		'youtube': 'youtube.com',
		'medium': 'medium.com',
		'ollama': 'ollama.com',
		'modelscope': 'modelscope.cn',
		'huggingface': 'huggingface.co',
		'openrouter': 'openrouter.ai',
		'siliconflow': 'siliconflow.cn',
		'douyin': 'douyin.com',
		'v.douyin': 'v.douyin.com',  // 添加抖音个人页支持
		'tiktok': 'tiktok.com',
		'baidu': 'baidu.com',  // 修复百度域名
		'v.flomo': 'v.flomoapp.com',  // 修复 flomo 域名
		'wikipedia': 'wikipedia.org',
		'archive': 'archive.org',
		'google': 'google.com',
		'docs.google': 'docs.google.com',
		'cloud.google': 'cloud.google.com'
	},
	
	// 特殊选择器图标
	SPECIAL: {
		'obsidianweb': {
			selector: 'body.fancy-obsidian-web-link .external-link[href^="https://"][href*="obsidian.md"]'
		},
		// obsidiannote should match internal note links and obsidian://... external links
		// EXCEPT advanced uri (obsidian://adv-uri) which is handled by advanceduri.
		// only support settingid now.
		'obsidiannote': {
			selector: 'body.fancy-internal-obsidian-link .internal-link, body.fancy-both-obsidian-link .internal-link, body.fancy-external-obsidian-link .external-link[href^="obsidian://"]:not([href^="obsidian://adv-uri"][href*="settingid"]), body.fancy-both-obsidian-link .external-link[href^="obsidian://"]:not([href^="obsidian://adv-uri"][href*="settingid"])'
		},
		'advancedurisetting': {
			selector: 'body.fancy-advanced-uri-link .external-link[href^="obsidian://adv-uri"][href*="settingid"]'
		},
		'google': {
			selector: 'body.fancy-web-link .external-link[href^="https://"][href*="google.com"]:not([href*="docs.google.com"]):not([href*="cloud.google.com"])'
		},
		'googledocs': {
			selector: 'body.fancy-web-link .external-link[href^="https://"][href*="docs.google.com"]'
		},
		'googlecloud': {
			selector: 'body.fancy-web-link .external-link[href^="https://"][href*="cloud.google.com"]'
		}
	}
};

// CSS 选择器常量
const CSS_SELECTORS = {
	URL_SCHEME: 'body.fancy-url-scheme .external-link',  // 依赖 fancy-url-scheme 类
	WEB_LINK: 'body.fancy-web-link .external-link[href^="https://"]',  // 依赖 fancy-web-link 类
	CUSTOM_DATA: '.external-link'
} as const;

// CSS 样式常量
const CSS_CONSTANTS = {
	ICON_SIZE: '0.8em',
	ICON_MARGIN: '3px',
	STYLE_ID: 'external-links-icon-styles'
} as const;

import { BUILTIN_ICONS } from './src/builtin-icons';

const DEFAULT_SETTINGS: ExternalLinksIconSettings = {
	icons: BUILTIN_ICONS,
	customIcons: {}
};


			"name": "snippetslab",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\" viewBox=\"0 0 32 32\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M11.334 9.311l5.794.026 4 .041c.364.037.768.112 1.083.306.512.316.856.799.994 1.384.184.779.186 2.791-.226 3.452-.358.576-.857.913-1.513 1.073l3.116 7.329 1.946 4.642c.108.307.215.634.217.961.003.707-.312 1.453-.816 1.949-.897.882-2.062.787-3.217.782l-1.955-.006-8.614.003c-1.344.001-3.012.092-4.323-.021-.394-.034-.783-.104-1.134-.293a2.73 2.73 0 0 1-1.328-1.638c-.155-.52-.124-1.011.025-1.525.195-.673.537-1.334.819-1.975l1.406-3.215 1.954-4.501 1.14-2.536c-.361-.122-.7-.283-.988-.537-.511-.45-.72-1.073-.759-1.736-.061-1.048-.129-2.431.62-3.255.481-.529 1.076-.675 1.759-.71zm7.908 8.371c-3.75.369-5.135 1.944-7.976 3.972-.489.349-1.367.698-1.729 1.13-.327.39-2.136 4.683-2.379 5.363-.061.171-.123.332-.1.517.028.232.163.466.347.609.436.34 4.614.179 5.427.177l7.419.002 3.691-.014c.219-.018.527-.038.691-.199.171-.168.311-.438.302-.682-.019-.584-.791-2.034-1.057-2.671l-3.482-8.242c-.382.006-.774-.004-1.154.038zm-7.618-6.565c-.231.004-.487-.016-.698.088-.282.347-.208 1.518-.161 1.972.018.178.051.423.2.541.623.201 1.747.096 2.428.082l-3.31 7.574c1.69-1.193 3.301-2.641 5.168-3.546 1.564-.716 3.05-1.041 4.772-1.071l-1.265-2.946c.472.038 2.232.17 2.561-.08.142-.107.159-.427.169-.591.027-.469.124-1.543-.196-1.901-.087-.097-.486-.084-.618-.087l-4.649-.019-4.401-.016z\" fill=\"url(#A)\"/><g fill=\"#26bae2\"><path d=\"M17.713 19.138a2.24 2.24 0 1 1 .385 4.464 2.24 2.24 0 1 1-.385-4.464zm-.072.91c-.632.119-1.093.677-1.093 1.319a1.35 1.35 0 0 0 1.342 1.343c.559 0 1.063-.35 1.258-.874.169-.453.081-.964-.231-1.334s-.8-.544-1.276-.454zm-5.153 2.702a1.79 1.79 0 0 1 2.066 1.467c.017.098.025.197.025.297 0 .871-.636 1.622-1.496 1.766a1.8 1.8 0 0 1-2.058-1.468 1.8 1.8 0 0 1 1.463-2.062zm.04.909a.9.9 0 0 0-.633.857.9.9 0 0 0 .896.896.9.9 0 0 0 .896-.896.88.88 0 0 0-.044-.278c-.151-.465-.648-.723-1.115-.579z\"/><path d=\"M18.417 25.562c.484-.046.922.313.971.797s-.302.924-.788.978a.89.89 0 0 1-.987-.796l-.005-.091c0-.458.353-.845.809-.888z\" fill-rule=\"nonzero\"/></g><g fill=\"#23e8c1\"><path d=\"M19.045 5.907c.065-.015.132-.023.199-.023a.9.9 0 0 1 .894.894.89.89 0 0 1-.044.276c-.119.367-.463.617-.85.617-.419 0-.784-.294-.873-.704a.9.9 0 0 1 .674-1.06z\" fill-rule=\"nonzero\"/><path d=\"M15.766.735c1.218-.176 2.351.663 2.537 1.88a2.24 2.24 0 0 1-1.86 2.551c-1.229.197-2.383-.645-2.571-1.875S14.535.914 15.766.735zm.053.902a1.35 1.35 0 0 0-1.049 1.576 1.35 1.35 0 0 0 1.573 1.054c.627-.122 1.083-.677 1.083-1.316a1.28 1.28 0 0 0-.026-.262c-.124-.625-.678-1.079-1.315-1.079a1.32 1.32 0 0 0-.266.027z\"/></g><defs><linearGradient id=\"A\" x1=\"15.875\" y1=\"9.363\" x2=\"15.979\" y2=\"31.144\" gradientUnits=\"userSpaceOnUse\"><stop offset=\"0\" stop-color=\"#26ddc8\"/><stop offset=\"1\" stop-color=\"#28abed\"/></linearGradient></defs></svg>",
			"order": 2,
			"linkType": "scheme"
		},
		"siyuan": {
			"name": "siyuan",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\" viewBox=\"0 0 256 256\" fill-rule=\"nonzero\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M75.239 24.551l.517-.854c.921-.055 1.781.842 2.468 1.448 4.046 3.561 7.708 7.786 11.539 11.6l27.078 27.015c2.2 2.195 8.928 9.668 11.283 10.648 3.197-1.635 8.064-7.381 10.801-10.125l25.613-25.645c4.337-4.338 8.661-9.318 13.43-13.146.922-.74 1.798-1.145 2.93-1.472a9.79 9.79 0 0 1 2.463 1.671c2.968 2.731 5.752 5.746 8.602 8.604l16.204 16.199 38.684 38.601c.737.757 2.238 2.15 2.632 3.116.575 1.409.401 3.9.425 5.411.168 10.478.013 20.985.006 31.466l.002 56.731-.002 28.266c-.002 6.009.357 12.271-.559 18.221-2.4-3.238-5.396-5.951-8.254-8.775l-11.273-11.155-39.071-39.062c-2.019-2.04-9.47-8.873-10.408-10.84-9.567 10.368-19.945 20.15-29.929 30.124l-13.425 13.392c-2.262 2.243-4.502 4.702-6.931 6.751-.558.471-1.191.77-1.871 1.021-.317.008-.652.005-.96-.077-1.453-.384-10.483-10.269-12.142-11.928l-21.599-21.554c-3.938-3.936-7.787-8.117-11.925-11.837-1.474-1.325-5.122-3.75-5.918-5.21-3.433 2.112-15.097 14.713-18.739 18.361L6.641 231.529c-1.082-6.76-.394-15.404-.382-22.408l.009-42.349-.005-49.247c-.004-8.12-.788-17.786.447-25.696 2.059-2.576 4.899-4.863 7.253-7.208l16.601-16.595 27.148-27.132c4.745-4.742 9.39-9.735 14.347-14.247.975-.886 2.016-1.5 3.18-2.096z\" fill=\"#3d3e42\"/><path d=\"M75.239 24.551c.626 4.885.378 10.084.376 15.008l-.053 24.516.001 63.391.086 35.69c-3.433 2.112-15.097 14.713-18.739 18.361L6.641 231.529c-1.082-6.76-.394-15.404-.382-22.408l.009-42.349-.005-49.247c-.004-8.12-.788-17.786.447-25.696 2.059-2.576 4.899-4.863 7.253-7.208l16.601-16.595 27.148-27.132c4.745-4.742 9.39-9.735 14.347-14.247.975-.886 2.016-1.5 3.18-2.096zm52.885 49.857c3.197-1.635 8.064-7.381 10.801-10.125l25.613-25.645c4.337-4.338 8.661-9.318 13.43-13.146.922-.74 1.798-1.145 2.93-1.472-.418 4.907-.228 9.914-.229 14.837l-.004 23.899-.001 75.353c.003 3.647.58 22.162-.315 24.365-9.567 10.368-19.945 20.15-29.929 30.124l-13.425 13.392c-2.262 2.243-4.502 4.702-6.931 6.751-.558.471-1.191.77-1.871 1.021-.224-5.606-.07-11.276-.071-16.89l-.004-30.4.006-92.064z\" fill=\"#db3a39\"/></svg>",
			"order": 3,
			"linkType": "scheme",
			"themeDarkSvgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\" viewBox=\"0 0 256 256\" fill-rule=\"nonzero\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M75.239 24.551l.517-.854c.921-.055 1.781.842 2.468 1.448 4.046 3.561 7.708 7.786 11.539 11.6l27.078 27.015c2.2 2.195 8.928 9.668 11.283 10.648 3.197-1.635 8.064-7.381 10.801-10.125l25.613-25.645c4.337-4.338 8.661-9.318 13.43-13.146.922-.74 1.798-1.145 2.93-1.472a9.79 9.79 0 0 1 2.463 1.671c2.968 2.731 5.752 5.746 8.602 8.604l16.204 16.199 38.684 38.601c.737.757 2.238 2.15 2.632 3.116.575 1.409.401 3.9.425 5.411.168 10.478.013 20.985.006 31.466l.002 56.731-.002 28.266c-.002 6.009.357 12.271-.559 18.221-2.4-3.238-5.396-5.951-8.254-8.775l-11.273-11.155-39.071-39.062c-2.019-2.04-9.47-8.873-10.408-10.84-9.567 10.368-19.945 20.15-29.929 30.124l-13.425 13.392c-2.262 2.243-4.502 4.702-6.931 6.751-.558.471-1.191.77-1.871 1.021-.317.008-.652.005-.96-.077-1.453-.384-10.483-10.269-12.142-11.928l-21.599-21.554c-3.938-3.936-7.787-8.117-11.925-11.837-1.474-1.325-5.122-3.75-5.918-5.21-3.433 2.112-15.097 14.713-18.739 18.361L6.641 231.529c-1.082-6.76-.394-15.404-.382-22.408l.009-42.349-.005-49.247c-.004-8.12-.788-17.786.447-25.696 2.059-2.576 4.899-4.863 7.253-7.208l16.601-16.595 27.148-27.132c4.745-4.742 9.39-9.735 14.347-14.247.975-.886 2.016-1.5 3.18-2.096z\" fill=\"#dadada\"/><path d=\"M75.239 24.551c.626 4.885.378 10.084.376 15.008l-.053 24.516.001 63.391.086 35.69c-3.433 2.112-15.097 14.713-18.739 18.361L6.641 231.529c-1.082-6.76-.394-15.404-.382-22.408l.009-42.349-.005-49.247c-.004-8.12-.788-17.786.447-25.696 2.059-2.576 4.899-4.863 7.253-7.208l16.601-16.595 27.148-27.132c4.745-4.742 9.39-9.735 14.347-14.247.975-.886 2.016-1.5 3.18-2.096zm52.885 49.857c3.197-1.635 8.064-7.381 10.801-10.125l25.613-25.645c4.337-4.338 8.661-9.318 13.43-13.146.922-.74 1.798-1.145 2.93-1.472-.418 4.907-.228 9.914-.229 14.837l-.004 23.899-.001 75.353c.003 3.647.58 22.162-.315 24.365-9.567 10.368-19.945 20.15-29.929 30.124l-13.425 13.392c-2.262 2.243-4.502 4.702-6.931 6.751-.558.471-1.191.77-1.871 1.021-.224-5.606-.07-11.276-.071-16.89l-.004-30.4.006-92.064z\" fill=\"#db3a39\"/></svg>"
		},
		"eagle": {
			"name": "eagle",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" viewBox=\"0 0 128 128\" xmlns:v=\"https://vecta.io/nano\"><linearGradient id=\"A\" gradientUnits=\"userSpaceOnUse\" x1=\"64\" x2=\"64\" y1=\"-7.805\" y2=\"59.457\"><stop offset=\"0\" stop-color=\"#4da1ff\"/><stop offset=\"1\" stop-color=\"#0072ee\"/></linearGradient><linearGradient id=\"B\" gradientUnits=\"userSpaceOnUse\" x1=\"35.877\" x2=\"61.169\" y1=\"98.605\" y2=\"77.42\"><stop offset=\"0\" stop-color=\"#fff\"/><stop offset=\"1\" stop-color=\"#b2d6ff\"/></linearGradient><g fill-rule=\"nonzero\"><path d=\"M64 128c35.346 0 64-28.654 64-64S99.346 0 64 0 0 28.654 0 64s28.654 64 64 64z\" fill=\"url(#A)\"/><path d=\"M96.425 92.3c-2.35 3-6.85 7.95-14.025 11.55-6.8 3.425-13.45 4.375-18.775 4.35-1.575 0-3.025-.1-4.35-.225A41.82 41.82 0 0 1 56.675 96c-.35-5.2.05-14.575 5.8-23.925 4.55-7.425 10.475-11.625 14.2-13.775-.05 1.125-.025 2.175 0 3.15.075 1.75.275 3.175.425 4.15.45 2.75 2.175 11.375 9.35 19.125 3.6 3.875 7.375 6.225 9.975 7.575z\" fill=\"#80bbff\"/><path d=\"M78 49.75a36.6 36.6 0 0 0-1.325 11.675c-1.9 1.325-4.25 3.225-6.575 5.8-5.9 6.575-7.95 13.5-8.65 16.325-.675 2.725-2.175 10.075.15 18.9.6 2.25 1.325 4.175 2.025 5.75-5.275-.025-9.275-.975-10.925-1.425-2.35-.625-8.725-2.425-15.1-7.225-1.225-.925-2.425-1.925-3.625-3.075.175-3.125.7-7 2.1-11.25 2.075-6.375 5.175-10.975 7.375-13.75L35.375 73.2c1.45-4 4.15-9.525 9.225-14.575C56.75 46.55 73.225 46.55 78.95 46.95c-.4.975-.7 1.9-.95 2.8z\" fill=\"url(#B)\"/><path d=\"M90.975 30.625c-2.625 2.025-8.05 6.75-11.45 14.825a32.73 32.73 0 0 0-1.5 4.3c-1.9-.1-4.375-.1-7.2.275a41.09 41.09 0 0 0-11.1 3.025 39.93 39.93 0 0 0-10.575 6.725c-3.7 3.25-6.175 6.6-7.75 9.15a28.38 28.38 0 0 1 4.825-1.5 29.97 29.97 0 0 1 6.325-.675 40.12 40.12 0 0 0-5.875 5.775c-2.125 2.575-4.75 6.4-6.65 11.475-2.375 6.325-2.625 12-2.475 15.625-3.6-2.7-7.175-6.35-10.05-11.275-1.175-2.025-7.95-14.1-4.1-29.075 1.95-7.625 5.85-12.9 8.225-15.65A29.4 29.4 0 0 0 26 45.75c-2.375 1.175-4.225 2.525-5.6 3.65 1.575-3.675 7.9-17.4 23.425-24.55 12.525-5.75 28.325-5.975 40.55 1 2.925 1.65 5.1 3.425 6.6 4.775z\" fill=\"#fff\"/><path d=\"M100.9 54.65c-1.7-.1-3.55-.125-5.5.05-3.725.3-6.65 1.1-8.275 1.6-2.275.7-4.15 1.525-5.6 2.25.125-3.475.8-6.3 1.4-8.25l1.025-2.825c2.975.6 6.575 1.65 10.475 3.475a51.98 51.98 0 0 1 6.475 3.7z\" fill=\"#b2d6ff\"/><path d=\"M106.3 63.7c-1.425-1.7-3.325-3.7-5.8-5.625-1.8-1.425-3.55-2.525-5.1-3.375-2.45-1.35-4.55-2.175-5.9-2.65-2.5-.9-4.775-1.425-6.6-1.725.675-2.175 1.475-3.9 2.025-5a31.42 31.42 0 0 1 2.325-3.875c2.375-3.375 5.15-5.85 7.375-7.5A23.82 23.82 0 0 1 98.55 37c.575.55 2.55 2.5 4.375 5.625 2.2 3.75 2.925 7.075 3.3 8.8.875 4.025.925 8.225.075 12.275z\" fill=\"#fff\"/></g></svg>",
			"order": 4,
			"linkType": "scheme"
		},
		"bear": {
			"name": "bear",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" viewBox=\"0 0 100 100\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M50 2c27.614 0 50 22.386 50 50 0 21.253-13.26 39.408-31.958 46.646l-2.854-4.331-.038-.056c-.005-.007-8.107-12.534-8.71-20.703-.996-13.51 23.221.037 29.043-21.504 1.36-5.03.037-7.226-3.966-6.587-24.577-6.581-14.048-17.802-40.902-15.076C37.266 26.796 33.787 25 30.181 25c-4.362 0-3.329 10.276-3.329 10.276C19.12 43.322 12.435 57.289 6.795 77.18 2.475 69.786 0 61.182 0 52 0 24.386 22.386 2 50 2z\" fill=\"#dd4c4f\"/></svg>",
			"order": 5,
			"linkType": "scheme"
		},
		"prodrafts": {
			"name": "prodrafts",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\" viewBox=\"0 0 256 256\" fill-rule=\"nonzero\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" fill=\"#12a3f6\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M178.047 37.775c1.087.254 22.048 21.698 25.172 24.707-13.991 12.376-27.001 26.377-40.282 39.534l-78.729 77.765-21.567 21.165c-4.356 4.322-8.658 9.55-13.728 12.974-5.585 3.771-21.292 8.829-28.278 11.179 5.689 2.951 11.212 6.2 17.113 8.727 14.457 6.19 34.019 9.78 48.913 3.038 4.97-2.249 9.233-5.658 13.302-9.236 8.366-7.356 15.681-13.716 26.988-15.784 9.442-1.727 18.401-.611 25.76 6.056 3.382 3.064 6.458 6.53 10.236 9.124 4.644 3.189 9.685 4.178 15.228 3.908 18.998-.929 28.652-14.124 43.923-22.77 5.914-3.348 11.631-5.049 18.277-6.309 1.857-.372 3.483-.858 5.199.215.951.595 1.714 1.515 1.942 2.625a2.71 2.71 0 0 1-.445 2.126c-.442.606-1.186 1.101-1.886 1.37-1.607.615-3.605.722-5.3 1.052a46.9 46.9 0 0 0-10.581 3.319c-18.346 8.287-25.58 22.823-48.215 25.398-9.437 1.074-17.656-.777-24.885-7.155-2.93-2.585-5.615-5.542-8.684-7.952-4.364-3.425-9.203-4.677-14.67-4.415-17.779.853-24.494 13.68-38.073 22.191a43.87 43.87 0 0 1-18.477 6.396c-22.747 2.627-46.62-5.82-64.372-19.919-.593-1.55-1.028-3.166-1.502-4.755 1.754-6.219 11.023-28.231 14.718-33.153 4.216-5.618 10.266-10.649 15.289-15.606l29.939-29.576L178.047 37.775zm35.498-31.193c4.491-.307 7.338.16 11.105 2.936 4.401 3.243 9.842 8.615 10.633 14.22.531 3.766-.877 7.117-3.095 10.09-1.99 2.666-13.988 14.884-16.2 16.269-.147.093-.747.11-.95.14l-.992-.817c-8.283-7.502-16.033-15.77-24.058-23.567C196.7 19.47 204.5 9.137 213.545 6.582z\"/></svg>",
			"order": 6,
			"linkType": "scheme"
		},
		"things": {
			"name": "things",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-miterlimit=\"1.5\" viewBox=\"0 0 1072 1072\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M819.329 1047H250.671C125.016 1047 23 944.984 23 819.329V250.671C23 125.016 125.016 23 250.671 23h568.658c125.655 0 227.672 102.016 227.672 227.671v568.658c0 125.655-102.017 227.671-227.672 227.671z\" fill=\"#2f78e5\"/><path d=\"M884.912 235.153v601.48c0 27.128-22.025 49.153-49.153 49.153H234.153c-27.128 0-49.153-22.025-49.153-49.153v-601.48C185 208.025 207.025 186 234.153 186h601.606c27.128 0 49.153 22.025 49.153 49.153z\" fill=\"#fff\"/><path d=\"M285 128h518c60.302 2.329 135.039 34.288 140 129 5.163 98.571 2.164 498.618.946 542.764C942.306 859.263 912.837 941.443 798 944c-102.43 2.281-494.835 2.675-539-1-40.248-2.365-127.127-28.462-130-140-2.874-111.58-4.635-478.91-1-536 4.661-73.191 43.75-140.257 157-139zm552 59c50.673 2.748 49 50 49 50v604c-7.062 52.122-55 46-55 46s-523.454-.474-586 0-58-53-58-53V239c2.249-55.059 53-52 53-52z\" fill=\"#002c73\"/><path d=\"M400 490l109 97c68.7-82.506 226.06-241.984 254-267 11.796-10.562 13-12 13-12s4.086-2.788 7 2l22 35c2.744 4.201 1.74 4.425-1 7S692.991 482.601 682 505c-14.858 20.151-83.108 116.317-104 149l-41 64s-4.816 6.63-11 2-165.971-174.123-170-179c-3.584-4.338-1.364-7.321 0-9s40-41 40-41 1.495-2.605 4-1z\" fill=\"#37414a\" stroke=\"#000\"/></svg>",
			"order": 7,
			"linkType": "scheme",
			"themeDarkSvgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-miterlimit=\"1.5\" viewBox=\"0 0 1072 1072\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M819.329 1047H250.671C125.016 1047 23 944.984 23 819.329V250.671C23 125.016 125.016 23 250.671 23h568.658c125.655 0 227.672 102.016 227.672 227.671v568.658c0 125.655-102.017 227.671-227.672 227.671z\" fill=\"#2f78e5\"/><path d=\"M885.385 235.643v601.48c0 27.128-22.025 49.153-49.153 49.153H234.626c-27.128 0-49.153-22.025-49.153-49.153v-601.48c0-27.128 22.025-49.153 49.153-49.153h601.606c27.128 0 49.153 22.025 49.153 49.153z\" fill=\"#dadada\"/><path d=\"M284.046 127.052h518c60.302 2.329 135.039 34.288 140 129 5.163 98.571 2.164 498.618.946 542.764-1.64 59.499-31.109 141.679-145.946 144.236-102.43 2.281-494.835 2.675-539-1-40.248-2.365-127.127-28.462-130-140-2.874-111.58-4.635-478.91-1-536 4.661-73.191 43.75-140.257 157-139zm552 59c50.673 2.748 49 50 49 50v604c-7.062 52.122-55 46-55 46s-523.454-.474-586 0-58-53-58-53v-595c2.249-55.059 53-52 53-52z\" fill=\"#002c73\"/><path d=\"M399.441 489.307l109 97c68.7-82.506 226.06-241.984 254-267 11.796-10.562 13-12 13-12s4.086-2.788 7 2l22 35c2.744 4.201 1.74 4.425-1 7s-111.009 130.601-122 153c-14.858 20.151-83.108 116.317-104 149l-41 64s-4.816 6.63-11 2-165.971-174.123-170-179c-3.584-4.338-1.364-7.321 0-9s40-41 40-41 1.495-2.605 4-1z\" fill=\"#37414a\" stroke=\"#000\"/></svg>"
		},
		"github": {
			"name": "github",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" viewBox=\"0 0 98 96\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362l-.08-9.127c-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a47 47 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126l-.08 13.526c0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z\"/></svg>",
			"order": 10,
			"linkType": "url",
			"themeDarkSvgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"#dadada\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" viewBox=\"0 0 98 96\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362l-.08-9.127c-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a47 47 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126l-.08 13.526c0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z\"/></svg>"
		},
		"sspai": {
			"name": "sspai",
			"svgData": "<svg clip-rule=\"evenodd\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" viewBox=\"0 0 64 64\" xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"32\" cy=\"32\" fill=\"#d7171c\" r=\"32\"/><path d=\"m15.5 21.607 31.25-5.25s1.25-.094 1.25 1v2.75s.594.925-.75 1.25-6.25 1.25-6.25 1.25l-.25 15.75s.067 1.048.75 2 4 7.25 4 7.25.07 1.078-.5 1c-.57-.077-4.5 0-4.5 0s-.788.377-1.5-1.25-3.5-6.75-3.5-6.75l-.25-17-7.75 1.25-.25 21-3.25 2.75s-1.631.22-2-.5 0-21.75 0-21.75l-7 .5s-.666-.058-.75-1 0-3.25 0-3.25.102-.803 1.25-1z\" fill=\"#fafafa\"/></svg>",
			"order": 11,
			"linkType": "url"
		},
		"mp.weixin.qq": {
			"name": "weixin",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\" viewBox=\"0 0 32 32\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M6.069 25.286C2.37 22.879-.003 19.159 0 14.989.005 7.745 7.178 1.869 16.009 1.875S32.005 7.767 32 15.011s-7.178 13.12-16.009 13.114c-2.26-.002-4.411-.388-6.361-1.084-.676.548-1.646 1.355-2.755 2.334-1.659 1.465-2.532.696-1.875-1.25.58-1.716.899-2.49 1.069-2.839zM10.313 8.75a2.19 2.19 0 0 0-2.188 2.187 2.19 2.19 0 0 0 2.188 2.188 2.19 2.19 0 0 0 2.187-2.188 2.19 2.19 0 0 0-2.187-2.187zm11.25 0a2.19 2.19 0 0 0-2.188 2.188 2.19 2.19 0 0 0 2.188 2.187 2.19 2.19 0 0 0 2.187-2.188 2.19 2.19 0 0 0-2.188-2.187z\" fill=\"#1aad19\"/></svg>",
			"order": 12,
			"linkType": "url"
		},
		"medium": {
			"name": "medium",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\" viewBox=\"0 0 1024 1024\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M1024 179.649v664.702C1024 943.502 943.502 1024 844.351 1024H179.649C80.498 1024 0 943.502 0 844.351V179.649C0 80.498 80.498 0 179.649 0h664.702C943.502 0 1024 80.498 1024 179.649z\" fill=\"#222\"/><path d=\"M1024 704.736v93a187.19 187.19 0 0 1-18 .852c-109.939 0-171.834-91.572-174.503-206.156-.079-4.43-.049-8.832.049-13.204a282.1 282.1 0 0 1 .306-8.153l.246-4.322.345-4.549c3.958-50.591 20.244-95.61 47.125-128.92 16.699-20.678 36.766-36.432 59.522-46.968 19.988-10.063 48.08-15.617 70.98-15.617h.99a194.4 194.4 0 0 1 12.94.431v25.587c-4.55-1.247-9.42-1.916-14.6-2.002-46.314.955-73.914 56.43-77.351 133.292H1024v21.662h-94.028l-.03.02c-4.239 74.89 36.75 138.181 94.058 155.047zM836.115 244.625l.808-.177v-6.253H672.014L518.891 598.084 365.768 238.195H188.059v6.253l.798.177c30.1 6.794 45.382 16.926 45.382 53.466v427.781c0 36.54-15.341 46.672-45.441 53.466l-.798.178v6.272h120.57v-6.253l-.797-.177c-30.101-6.794-45.383-16.926-45.383-53.466V322.905l196.703 462.883h11.156l202.434-475.792v426.461c-2.579 28.86-17.723 37.771-44.978 43.925l-.808.187v6.204h210.026v-6.204l-.808-.187c-27.284-6.154-42.793-15.065-45.372-43.925l-.138-438.366h.138c0-36.54 15.281-46.672 45.372-53.466z\" fill=\"#fff\" fill-rule=\"nonzero\"/></svg>",
			"order": 13,
			"linkType": "url",
			"themeDarkSvgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\" viewBox=\"0 0 1024 1024\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M1024 179.649v664.702C1024 943.502 943.502 1024 844.351 1024H179.649C80.498 1024 0 943.502 0 844.351V179.649C0 80.498 80.498 0 179.649 0h664.702C943.502 0 1024 80.498 1024 179.649z\" fill=\"#fefefe\"/><path d=\"M1024 704.736v93a187.19 187.19 0 0 1-18 .852c-109.939 0-171.834-91.572-174.503-206.156-.079-4.43-.049-8.832.049-13.204a282.1 282.1 0 0 1 .306-8.153l.246-4.322.345-4.549c3.958-50.591 20.244-95.61 47.125-128.92 16.699-20.678 36.766-36.432 59.522-46.968 19.988-10.063 48.08-15.617 70.98-15.617h.99a194.4 194.4 0 0 1 12.94.431v25.587c-4.55-1.247-9.42-1.916-14.6-2.002-46.314.955-73.914 56.43-77.351 133.292H1024v21.662h-94.028l-.03.02c-4.239 74.89 36.75 138.181 94.058 155.047zM836.115 244.625l.808-.177v-6.253H672.014L518.891 598.084 365.768 238.195H188.059v6.253l.798.177c30.1 6.794 45.382 16.926 45.382 53.466v427.781c0 36.54-15.341 46.672-45.441 53.466l-.798.178v6.272h120.57v-6.253l-.797-.177c-30.101-6.794-45.383-16.926-45.383-53.466V322.905l196.703 462.883h11.156l202.434-475.792v426.461c-2.579 28.86-17.723 37.771-44.978 43.925l-.808.187v6.204h210.026v-6.204l-.808-.187c-27.284-6.154-42.793-15.065-45.372-43.925l-.138-438.366h.138c0-36.54 15.281-46.672 45.372-53.466z\" fill-rule=\"nonzero\"/></svg>"
		},
		"douban": {
			"name": "douban",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" viewBox=\"0 0 64 64\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M64 16v32a16.01 16.01 0 0 1-16 16H16A16.01 16.01 0 0 1 0 48V16A16.01 16.01 0 0 1 16 0h32a16.01 16.01 0 0 1 16 16z\" fill=\"#2e953d\"/><path d=\"M46.614 23.431h-28.17v9.952h28.17zm-33.912-5.204h39.593v20.358H12.702zM8.535 7.586h47.93v5.209H8.535zm13.404 31.865c2.099 3.001 3.978 6.628 5.636 10.867h10.023c1.986-3.27 3.732-6.897 5.228-10.867l5.761 2.026c-1.506 3.346-3.132 6.298-4.856 8.841H57.82v5.151H7.18v-5.151h14.759c-1.355-2.737-3.115-5.682-5.302-8.841z\" fill=\"#fff\" fill-rule=\"nonzero\"/></svg>",
			"order": 14,
			"linkType": "url",
			"themeDarkSvgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" viewBox=\"0 0 64 64\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M46.614 23.431h-28.17v9.952h28.17zm-33.912-5.204h39.593v20.358H12.702zM8.535 7.586h47.93v5.209H8.535zm13.404 31.865c2.099 3.001 3.978 6.628 5.636 10.867h10.023c1.986-3.27 3.732-6.897 5.228-10.867l5.761 2.026c-1.506 3.346-3.132 6.298-4.856 8.841H57.82v5.151H7.18v-5.151h14.759c-1.355-2.737-3.115-5.682-5.302-8.841z\" fill=\"#2e953d\" fill-rule=\"nonzero\"/></svg>"
		},
		"xiaoyuzhoufm": {
			"name": "xiaoyuzhoufm",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" viewBox=\"0 0 128 128\" xmlns:v=\"https://vecta.io/nano\"><linearGradient id=\"A\" gradientUnits=\"userSpaceOnUse\"><stop offset=\"0\" stop-color=\"#25b4e1\"/><stop offset=\"1\" stop-color=\"#e5d5be\"/></linearGradient><linearGradient id=\"B\" x1=\"48.787\" x2=\"85.224\" href=\"#A\" y1=\"146.23\" y2=\"-104.637\"/><linearGradient id=\"C\" x1=\"9\" x2=\"186.396\" href=\"#A\" y1=\"19.94\" y2=\"201.027\"/><clipPath id=\"D\"><path clip-rule=\"evenodd\" d=\"M0 0h128v128H0z\"/></clipPath><g clip-path=\"url(#D)\"><path d=\"m11.929 99.224c-5.812-7.413 12.037-31.126 39.834-52.921 27.796-21.795 55.082-33.472 60.894-26.06 5.812 7.413-12.036 31.125-39.833 52.921-27.797 21.795-55.083 33.472-60.895 26.06z\" fill=\"none\" stroke=\"url(#B)\" stroke-width=\"8.53\"/><path d=\"M78.175 80.365C67.072 89.22 56.166 96.835 46.6 102.596c6.129 3.141 12.934 4.734 19.819 4.64 23.294-.315 41.896-19.469 41.58-42.848-.045-3.328-.473-6.565-1.241-9.713-7.7 7.999-17.565 16.879-28.583 25.69zM23.74 65.526c.063 4.65.849 9.12 2.313 13.282l3.342 7.337c.874 1.524 1.832 2.962 2.875 4.356 9.742-5.38 22.046-13.696 34.965-23.984 12.834-10.201 23.663-20.332 31.062-28.582-1.258-1.519-2.643-2.951-4.112-4.254l-6.423-4.863a42.12 42.12 0 0 0-22.442-6.14c-23.294.314-41.895 19.511-41.58 42.848z\" fill=\"url(#C)\" fill-rule=\"nonzero\"/></g></svg>",
			"order": 15,
			"linkType": "url"
		},
		"bilibili": {
			"name": "bilibili",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" viewBox=\"0 0 68 65\" xmlns:v=\"https://vecta.io/nano\"><g fill=\"#06b6f2\" fill-rule=\"nonzero\"><path d=\"M64.039 17.924c-1.166-2.185-2.866-3.888-5.048-5.061-2.194-1.173-4.353-1.771-10.078-1.771h-.689l2.377-2.778c1.241-1.444 1.068-3.635-.373-4.871-1.418-1.219-3.583-1.07-4.864.374l-6.231 7.28h-10.48l-6.266-7.321c-1.24-1.403-3.405-1.553-4.824-.328a3.47 3.47 0 0 0-.373 4.871l2.378 2.778h-.77c-5.639 0-7.844.598-9.952 1.708l-.126.069c-2.182 1.167-3.882 2.87-5.048 5.061-1.171 2.197-1.769 4.365-1.769 10.098v17.828c.011 5.532.609 7.712 1.7 9.805l.069.127a12.14 12.14 0 0 0 5.048 5.061l.195.103c2.085 1.081 4.273 1.668 9.883 1.668h30.276c5.519-.011 7.695-.61 9.786-1.702l.126-.069c2.182-1.168 3.882-2.87 5.048-5.061 1.172-2.197 1.769-4.365 1.769-10.098V28.033c0-5.653-.597-7.861-1.7-9.972zm-5.278 10.098v17.741c0 2.197-.103 3.796-.304 4.888l-.011.069a5.48 5.48 0 0 1-.62 1.736 5.09 5.09 0 0 1-2.159 2.162c-.632.34-1.051.489-1.729.621-1.103.213-2.751.316-5.025.316h-30.19c-2.194 0-3.79-.103-4.876-.305l-.069-.011c-.678-.132-1.097-.282-1.729-.621a5.09 5.09 0 0 1-2.159-2.162c-.339-.632-.488-1.052-.62-1.736-.201-1.047-.304-2.565-.316-4.647V27.941c0-2.197.103-3.795.304-4.888l.012-.069a5.43 5.43 0 0 1 .62-1.737 5.09 5.09 0 0 1 2.159-2.162 5.38 5.38 0 0 1 1.729-.621c1.039-.201 2.555-.305 4.634-.316h30.58c2.194 0 3.79.103 4.876.305l.069.011a5.38 5.38 0 0 1 1.729.621 5.09 5.09 0 0 1 2.159 2.162c.339.633.488 1.052.62 1.737.212 1.11.316 2.755.316 5.038z\"/><use href=\"#B\"/><use href=\"#B\" x=\"22.971\"/></g><defs ><path id=\"B\" d=\"M22.575 27.924c2.538 0 4.594 2.059 4.594 4.6v8.626c0 2.542-2.056 4.601-4.594 4.601s-4.594-2.059-4.594-4.601v-8.626c0-2.542 2.056-4.6 4.594-4.6z\"/></defs></svg>",
			"order": 16,
			"linkType": "url"
		},
		"youtube": {
			"name": "youtube",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"nonzero\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" viewBox=\"0 0 256 256\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M250.351 73.075c-2.984-11.029-11.627-19.672-22.656-22.657C207.829 45 127.875 45 127.875 45s-79.958.164-99.824 5.582C17.022 53.567 8.379 62.211 5.395 73.24c-6.009 35.298-8.34 89.084.165 122.97 2.984 11.029 11.627 19.672 22.656 22.657 19.866 5.418 99.822 5.418 99.822 5.418s79.955 0 99.82-5.418a32.22 32.22 0 0 0 22.657-22.657c6.338-35.348 8.291-89.1-.164-123.134z\" fill=\"red\"/><path d=\"M102.426 173.06l66.328-38.418-66.328-38.418z\" fill=\"#fff\"/></svg>",
			"order": 17,
			"linkType": "url"
		},
		"ollama": {
			"name": "ollama",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" fill-rule=\"evenodd\" viewBox=\"0 0 24 24\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M7.905 1.09a1.66 1.66 0 0 1 .588.41c.295.306.544.744.734 1.263s.315 1.1.362 1.68a5.054 5.054 0 0 1 2.049-.636l.051-.004c.87-.07 1.73.087 2.48.474l.297.17a6.43 6.43 0 0 1 .36-1.644c.19-.52.439-.957.733-1.264a1.67 1.67 0 0 1 .589-.41c.257-.1.53-.118.796-.042.401.114.745.368 1.016.737.248.337.434.769.561 1.287.23.934.27 2.163.115 3.645l.053.04.026.019c.757.576 1.284 1.397 1.563 2.35.435 1.487.216 3.155-.534 4.088l-.018.021.002.003c.417.762.67 1.567.724 2.4l.002.03c.064 1.065-.2 2.137-.814 3.19l-.007.01.01.024c.472 1.157.62 2.322.438 3.486l-.006.039a.651.651 0 0 1-.747.536.648.648 0 0 1-.54-.742c.167-1.033.01-2.069-.48-3.123a.643.643 0 0 1 .04-.617l.004-.006c.604-.924.854-1.83.8-2.72-.046-.779-.325-1.544-.8-2.273a.644.644 0 0 1 .18-.886l.009-.006c.243-.159.467-.565.58-1.12a4.229 4.229 0 0 0-.095-1.974c-.205-.7-.58-1.284-1.105-1.683-.595-.454-1.383-.673-2.38-.61a.653.653 0 0 1-.632-.371c-.314-.665-.772-1.141-1.343-1.436a3.288 3.288 0 0 0-1.772-.332c-1.245.099-2.343.801-2.67 1.686a.652.652 0 0 1-.61.425c-1.067.002-1.893.252-2.497.703-.522.39-.878.935-1.066 1.588a4.07 4.07 0 0 0-.068 1.886c.112.558.331 1.02.582 1.269l.008.007c.212.207.257.53.109.785-.36.622-.629 1.549-.673 2.44-.05 1.018.186 1.902.719 2.536l.016.019a.643.643 0 0 1 .095.69c-.576 1.236-.753 2.252-.562 3.052a.652.652 0 0 1-1.269.298c-.243-1.018-.078-2.184.473-3.498l.014-.035-.008-.012a4.339 4.339 0 0 1-.598-1.309l-.005-.019a5.764 5.764 0 0 1-.177-1.785c.044-.91.278-1.842.622-2.59l.012-.026-.002-.002c-.293-.418-.51-.953-.63-1.545l-.005-.024a5.352 5.352 0 0 1 .093-2.49c.262-.915.777-1.701 1.536-2.269l.186-.132c-.159-1.493-.119-2.73.112-3.67.127-.518.314-.95.562-1.287.27-.368.614-.622 1.015-.737a1.23 1.23 0 0 1 .797.042zm4.116 9.09c.936 0 1.8.313 2.446.855.63.527 1.005 1.235 1.005 1.94 0 .888-.406 1.58-1.133 2.022-.62.375-1.451.557-2.403.557-1.009 0-1.871-.259-2.493-.734s-.963-1.13-.963-1.845c0-.707.398-1.417 1.056-1.946.668-.537 1.55-.849 2.485-.849zm0 .896a3.07 3.07 0 0 0-1.916.65c-.461.37-.722.835-.722 1.25 0 .428.21.829.61 1.134.455.347 1.124.548 1.943.548.799 0 1.473-.147 1.932-.426s.7-.686.7-1.257c0-.423-.246-.89-.683-1.256-.484-.405-1.14-.643-1.864-.643zm.662 1.21l.004.004a.35.35 0 0 1-.056.49l-.292.23v.446a.375.375 0 1 1-.752 0v-.46l-.271-.218a.347.347 0 0 1-.052-.49.353.353 0 0 1 .494-.051l.215.172.22-.174a.353.353 0 0 1 .49.051zm-5.04-1.919a.87.87 0 1 1-.001 1.742.87.87 0 1 1 0-1.742zm8.706 0a.87.87 0 0 1 0 1.742.87.87 0 1 1 0-1.742zM7.44 2.3l-.003.002a.659.659 0 0 0-.285.238l-.005.006c-.138.189-.258.467-.348.832-.17.692-.216 1.631-.124 2.782.43-.128.899-.208 1.404-.237l.01-.001.019-.034.148-.239c.123-.771.022-1.692-.253-2.444-.134-.364-.297-.65-.453-.813a.628.628 0 0 0-.107-.09L7.44 2.3zm9.174.04l-.002.001a.628.628 0 0 0-.107.09c-.156.163-.32.45-.453.814-.29.794-.387 1.776-.23 2.572l.058.097.008.014h.03a5.184 5.184 0 0 1 1.466.212c.086-1.124.038-2.043-.128-2.722-.09-.365-.21-.643-.349-.832l-.004-.006a.659.659 0 0 0-.285-.239h-.004z\"/></svg>",
			"order": 18,
			"linkType": "url",
			"themeDarkSvgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"#dadada\" fill-rule=\"evenodd\" viewBox=\"0 0 24 24\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M7.905 1.09a1.66 1.66 0 0 1 .588.41c.295.306.544.744.734 1.263s.315 1.1.362 1.68a5.054 5.054 0 0 1 2.049-.636l.051-.004c.87-.07 1.73.087 2.48.474l.297.17a6.43 6.43 0 0 1 .36-1.644c.19-.52.439-.957.733-1.264a1.67 1.67 0 0 1 .589-.41c.257-.1.53-.118.796-.042.401.114.745.368 1.016.737.248.337.434.769.561 1.287.23.934.27 2.163.115 3.645l.053.04.026.019c.757.576 1.284 1.397 1.563 2.35.435 1.487.216 3.155-.534 4.088l-.018.021.002.003c.417.762.67 1.567.724 2.4l.002.03c.064 1.065-.2 2.137-.814 3.19l-.007.01.01.024c.472 1.157.62 2.322.438 3.486l-.006.039a.651.651 0 0 1-.747.536.648.648 0 0 1-.54-.742c.167-1.033.01-2.069-.48-3.123a.643.643 0 0 1 .04-.617l.004-.006c.604-.924.854-1.83.8-2.72-.046-.779-.325-1.544-.8-2.273a.644.644 0 0 1 .18-.886l.009-.006c.243-.159.467-.565.58-1.12a4.229 4.229 0 0 0-.095-1.974c-.205-.7-.58-1.284-1.105-1.683-.595-.454-1.383-.673-2.38-.61a.653.653 0 0 1-.632-.371c-.314-.665-.772-1.141-1.343-1.436a3.288 3.288 0 0 0-1.772-.332c-1.245.099-2.343.801-2.67 1.686a.652.652 0 0 1-.61.425c-1.067.002-1.893.252-2.497.703-.522.39-.878.935-1.066 1.588a4.07 4.07 0 0 0-.068 1.886c.112.558.331 1.02.582 1.269l.008.007c.212.207.257.53.109.785-.36.622-.629 1.549-.673 2.44-.05 1.018.186 1.902.719 2.536l.016.019a.643.643 0 0 1 .095.69c-.576 1.236-.753 2.252-.562 3.052a.652.652 0 0 1-1.269.298c-.243-1.018-.078-2.184.473-3.498l.014-.035-.008-.012a4.339 4.339 0 0 1-.598-1.309l-.005-.019a5.764 5.764 0 0 1-.177-1.785c.044-.91.278-1.842.622-2.59l.012-.026-.002-.002c-.293-.418-.51-.953-.63-1.545l-.005-.024a5.352 5.352 0 0 1 .093-2.49c.262-.915.777-1.701 1.536-2.269l.186-.132c-.159-1.493-.119-2.73.112-3.67.127-.518.314-.95.562-1.287.27-.368.614-.622 1.015-.737a1.23 1.23 0 0 1 .797.042zm4.116 9.09c.936 0 1.8.313 2.446.855.63.527 1.005 1.235 1.005 1.94 0 .888-.406 1.58-1.133 2.022-.62.375-1.451.557-2.403.557-1.009 0-1.871-.259-2.493-.734s-.963-1.13-.963-1.845c0-.707.398-1.417 1.056-1.946.668-.537 1.55-.849 2.485-.849zm0 .896a3.07 3.07 0 0 0-1.916.65c-.461.37-.722.835-.722 1.25 0 .428.21.829.61 1.134.455.347 1.124.548 1.943.548.799 0 1.473-.147 1.932-.426s.7-.686.7-1.257c0-.423-.246-.89-.683-1.256-.484-.405-1.14-.643-1.864-.643zm.662 1.21l.004.004a.35.35 0 0 1-.056.49l-.292.23v.446a.375.375 0 1 1-.752 0v-.46l-.271-.218a.347.347 0 0 1-.052-.49.353.353 0 0 1 .494-.051l.215.172.22-.174a.353.353 0 0 1 .49.051zm-5.04-1.919a.87.87 0 1 1-.001 1.742.87.87 0 1 1 0-1.742zm8.706 0a.87.87 0 0 1 0 1.742.87.87 0 1 1 0-1.742zM7.44 2.3l-.003.002a.659.659 0 0 0-.285.238l-.005.006c-.138.189-.258.467-.348.832-.17.692-.216 1.631-.124 2.782.43-.128.899-.208 1.404-.237l.01-.001.019-.034.148-.239c.123-.771.022-1.692-.253-2.444-.134-.364-.297-.65-.453-.813a.628.628 0 0 0-.107-.09L7.44 2.3zm9.174.04l-.002.001a.628.628 0 0 0-.107.09c-.156.163-.32.45-.453.814-.29.794-.387 1.776-.23 2.572l.058.097.008.014h.03a5.184 5.184 0 0 1 1.466.212c.086-1.124.038-2.043-.128-2.722-.09-.365-.21-.643-.349-.832l-.004-.006a.659.659 0 0 0-.285-.239h-.004z\"/></svg>"
		},
		"modelscope": {
			"name": "modelscope",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" viewBox=\"0 0 128 128\" xmlns:v=\"https://vecta.io/nano\"><clipPath id=\"A\"><use href=\"#C\" clip-rule=\"evenodd\"/></clipPath><use href=\"#C\" fill=\"#fff\"/><g clip-path=\"url(#A)\"><path d=\"M0 0h128v128H0z\" fill=\"#644dff\" fill-rule=\"nonzero\"/></g><g fill-rule=\"nonzero\"><path d=\"M20 32v12H7v26h13v24h24V82H31V70H20V57h11V44h13V32zm63 0v12h13v13h12v13h13l-.001-18c-.015-2.209.001 17 .001-8-12.985-.006-9.855 0-13 0V32z\" fill=\"#f4f4ff\"/><path d=\"M10 46v11h10V46zm98 0v11h10V46z\" fill=\"#644dff\"/><path d=\"M44 57v13h13v12h13V70h13V57H70v13H57V57zm52 13v12H83v12h25l-.001-16c-.015-2.209.001 16 .001-8H96z\" fill=\"#f4f4ff\"/></g><defs ><path id=\"C\" d=\"M128 32v64c0 17.661-14.339 32-32 32H32c-17.661 0-32-14.339-32-32V32C0 14.339 14.339 0 32 0h64c17.661 0 32 14.339 32 32z\"/></defs></svg>",
			"order": 19,
			"linkType": "url"
		},
		"huggingface": {
			"name": "huggingface",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\" viewBox=\"0 0 32 32\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M31.593 24.595c.253.711.192 1.469-.144 2.128-.243.482-.59.854-1.014 1.187-.512.395-1.149.731-1.917 1.054a22.38 22.38 0 0 1-2.546.874c-1.311.332-2.571.543-3.847.553-1.826.017-3.399-.405-4.517-1.483a14.86 14.86 0 0 1-1.755.109c-.559 0-1.112-.033-1.661-.099-1.122 1.071-2.688 1.49-4.507 1.473-1.276-.01-2.536-.221-3.85-.553a22.57 22.57 0 0 1-2.543-.874c-.768-.323-1.405-.659-1.913-1.054-.428-.333-.775-.705-1.018-1.187-.333-.659-.397-1.417-.141-2.128-.236-.544-.296-1.167-.111-1.856a2.84 2.84 0 0 1 .397-.86 3.13 3.13 0 0 1-.087-.425c-.128-.903.192-1.727.795-2.366.296-.32.616-.541.95-.682-.246-1.022-.374-2.073-.374-3.147C1.79 7.659 8.085 1.5 15.853 1.5c2.668 0 5.164.725 7.292 1.99.384.231.762.478 1.122.742.179.132.357.267.529.409a10.6 10.6 0 0 1 .512.431c.498.445.967.923 1.394 1.434a11.05 11.05 0 0 1 .418.52 12.24 12.24 0 0 1 .758 1.098c.354.567.664 1.16.933 1.776a13.41 13.41 0 0 1 .472 1.266c.205.645.363 1.311.471 1.997a15.57 15.57 0 0 1 .088.688 13.88 13.88 0 0 1 .074 1.408 13.42 13.42 0 0 1-.367 3.107 2.79 2.79 0 0 1 1.047.722c.603.639.923 1.466.795 2.369a3.18 3.18 0 0 1-.087.422 2.84 2.84 0 0 1 .397.86c.185.689.125 1.312-.108 1.856\" fill=\"#fff\" fill-rule=\"nonzero\"/><ellipse cx=\"15.747\" cy=\"15.259\" rx=\"11.705\" ry=\"11.452\" fill=\"#ffd21e\"/><path d=\"M27.453 15.259c0-6.325-5.241-11.452-11.706-11.452S4.042 8.934 4.042 15.259 9.283 26.71 15.747 26.71s11.706-5.127 11.706-11.451zm-24.758 0c0-7.053 5.844-12.77 13.052-12.77S28.8 8.206 28.8 15.259s-5.844 12.769-13.053 12.769S2.695 22.311 2.695 15.259z\" fill=\"#ffac03\" fill-rule=\"nonzero\"/><path d=\"M19.551 12.141c-.384-.132-1.038.485-1.245.105a1.63 1.63 0 0 1 .697-2.228c.821-.427 1.841-.122 2.278.681a1.63 1.63 0 0 1-.697 2.229c-.433.225-.604-.638-1.033-.787zm-7.935 0c-.43.149-.601 1.012-1.034.787-.821-.428-1.133-1.425-.697-2.229s1.457-1.108 2.278-.681a1.63 1.63 0 0 1 .697 2.228c-.207.38-.861-.237-1.244-.105zm4.047 7.909c-3.31 0-4.379-2.888-4.379-4.371s1.961.786 4.379.786c1.162 0 2.218-.524 3.001-.903.849-.411 1.378-.654 1.378.117 0 1.483-1.068 4.371-4.379 4.371z\" fill=\"#3a3b45\"/><path d=\"M13.125 19.296c.356-.708 1.003-1.25 1.787-1.479.265-.077.545.873.835.873.311 0 .61-.944.891-.856l.124.042c.671.243 1.226.72 1.561 1.33-.655.505-1.526.844-2.66.844-1.065 0-1.898-.299-2.538-.754z\" fill=\"#ef4e4e\"/><use href=\"#A\" x=\"6.905\" y=\"11.551\" width=\"18\" height=\"3\"/><g fill-rule=\"nonzero\"><path d=\"M5.747 17.318c-.545 0-1.033.219-1.372.617-.211.246-.43.643-.448 1.237-.229-.064-.449-.1-.654-.1-.522 0-.994.195-1.327.551-.429.456-.619 1.017-.536 1.579.039.267.13.506.267.728-.288.228-.5.545-.602.926-.08.299-.163.922.267 1.563a1.53 1.53 0 0 0-.077.13c-.258.479-.275 1.02-.047 1.525.345.764 1.203 1.366 2.869 2.012l1.993.661c1.371.348 2.61.525 3.683.525 1.972 0 3.383-.591 4.196-1.756 1.307-1.877 1.12-3.593-.572-5.247-.936-.916-1.558-2.266-1.688-2.562-.262-.877-.953-1.852-2.102-1.852h0a1.9 1.9 0 0 0-.291.022c-.503.078-.943.361-1.257.787-.339-.412-.669-.74-.967-.926-.449-.278-.898-.42-1.335-.42m0 1.318c.172 0 .382.072.613.216.719.445 2.105 2.777 2.613 3.684a.82.82 0 0 0 .722.432c.52 0 .925-.505.048-1.147-1.32-.966-.857-2.545-.227-2.642.028-.004.055-.006.081-.006.573 0 .826.965.826.965s.74 1.82 2.012 3.063 1.337 2.242.41 3.572c-.632.907-1.842 1.181-3.082 1.181-1.287 0-2.605-.295-3.344-.483-.037-.009-4.531-1.251-3.962-2.308.096-.178.253-.249.452-.249.801 0 2.259 1.167 2.886 1.167.14 0 .239-.058.28-.2.267-.938-4.062-1.332-3.697-2.69.064-.24.239-.338.484-.337 1.059 0 3.436 1.822 3.934 1.822.039 0 .066-.011.081-.034.249-.394.112-.669-1.647-1.711s-2.994-1.668-2.292-2.417c.081-.086.196-.124.335-.124 1.068 0 3.591 2.247 3.591 2.247s.682.693 1.094.693a.25.25 0 0 0 .229-.127c.292-.482-2.712-2.709-2.882-3.628-.115-.623.081-.939.442-.939\" fill=\"#ffac03\"/><path d=\"M12.845 26.773c.927-1.33.862-2.328-.41-3.572s-2.012-3.063-2.012-3.063-.277-1.056-.907-.959-1.092 1.676.227 2.642-.263 1.622-.77.715-1.894-3.239-2.613-3.684-1.224-.197-1.055.723 3.175 3.146 2.882 3.629-1.323-.567-1.323-.567-3.224-2.871-3.926-2.123.533 1.375 2.292 2.417 1.896 1.317 1.647 1.711-4.134-2.809-4.499-1.451 3.964 1.752 3.697 2.69-3.049-1.775-3.618-.718 3.925 2.299 3.961 2.308c1.452.369 5.139 1.15 6.427-.698\" fill=\"#ffd21e\"/><path d=\"M25.916 17.318c.545 0 1.033.219 1.373.617.21.246.429.643.447 1.237.229-.064.449-.1.654-.1.523 0 .994.195 1.328.551.428.456.618 1.017.535 1.579-.039.267-.13.506-.267.728.288.228.5.545.602.926a1.9 1.9 0 0 1-.266 1.563l.076.13c.258.479.275 1.02.047 1.525-.345.764-1.203 1.366-2.869 2.012l-1.993.661c-1.37.348-2.61.525-3.683.525-1.971 0-3.383-.591-4.196-1.756-1.307-1.877-1.12-3.593.572-5.247.936-.916 1.559-2.266 1.688-2.562.262-.877.953-1.852 2.102-1.852h0a1.89 1.89 0 0 1 .291.022c.503.078.943.361 1.257.787.34-.412.669-.74.967-.926.449-.278.898-.42 1.335-.42m0 1.318c-.172 0-.382.072-.613.216-.719.445-2.105 2.777-2.613 3.684a.82.82 0 0 1-.722.432c-.52 0-.925-.505-.048-1.147 1.32-.966.857-2.545.227-2.642-.028-.004-.055-.006-.081-.006-.573 0-.825.965-.825.965s-.741 1.82-2.013 3.063-1.337 2.242-.41 3.572c.632.907 1.842 1.181 3.082 1.181 1.287 0 2.606-.295 3.345-.483.036-.009 4.531-1.251 3.961-2.308-.095-.178-.253-.249-.451-.249-.802 0-2.26 1.167-2.887 1.167-.14 0-.239-.058-.279-.2-.268-.938 4.061-1.332 3.696-2.69-.064-.24-.239-.338-.484-.337-1.059 0-3.436 1.822-3.934 1.822-.038 0-.066-.011-.08-.034-.25-.394-.113-.669 1.646-1.711s2.994-1.668 2.292-2.417c-.081-.086-.195-.124-.335-.124-1.068 0-3.591 2.247-3.591 2.247s-.681.693-1.093.693c-.095 0-.176-.037-.23-.127-.292-.482 2.712-2.709 2.882-3.628.115-.623-.081-.939-.442-.939\" fill=\"#ffac03\"/><path d=\"M18.818 26.773c-.927-1.33-.862-2.328.41-3.572s2.013-3.063 2.013-3.063.276-1.056.906-.959 1.092 1.676-.227 2.642.263 1.622.77.715 1.894-3.239 2.613-3.684 1.224-.197 1.055.723-3.174 3.146-2.882 3.629 1.323-.567 1.323-.567 3.224-2.871 3.926-2.123-.533 1.375-2.292 2.417-1.896 1.317-1.646 1.711 4.133-2.809 4.498-1.451-3.964 1.752-3.696 2.69 3.048-1.775 3.617-.718-3.925 2.299-3.961 2.308c-1.452.369-5.139 1.15-6.427-.698\" fill=\"#ffd21e\"/></g><defs><image id=\"A\" width=\"18\" height=\"3\" href=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAADCAYAAACeRF9pAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAiUlEQVQImY3NMQ4BURiF0e/XmJcMyUzk6SYShdYerMEKNFah0NmIHShErScqURmhQKFQiHnmqinE2cAxzWuiCNwbnv6obc0k4NOCyfCIGR+mi5TVzrHcxIwHJ3rdmzhcoe4wzZwoXtDy7M+R+STgqiW/bPOITvaAZxD5BeII0zoTCOz7/1MpUTHeLQwthHCd0J0AAAAASUVORK5CYII=\"/></defs></svg>",
			"order": 20,
			"linkType": "url"
		},
		"file": {
			"name": "file",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-miterlimit=\"1.5\" viewBox=\"0 0 413 414\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M351 91.363v231.274c0 50.148-40.715 90.863-90.863 90.863H90.863C40.715 413.5 0 372.785 0 322.637V91.363C0 41.215 40.715.5 90.863.5h169.274C310.285.5 351 41.215 351 91.363z\" fill=\"#0a99fa\" fill-opacity=\".99\"/><path d=\"M222 0s-53.828 85.124-50 237c4 1 51 0 56 2 3.586 1.934-6 111.5 20 174h62s103 11.33 103-99V119c0-47 0-119-119-119h-72z\" fill=\"#d4e2f2\"/><g fill=\"#212121\"><use href=\"#A\"/><use href=\"#A\" x=\"175\"/></g><path d=\"m92 271c22 29 61 46 114 45 39.993-.755 79-6 113-44\" fill=\"none\" stroke=\"#2d2d2d\" stroke-width=\"17\"/><defs><path id=\"A\" d=\"m127 132.5v30c0 4.691-3.809 8.5-8.5 8.5s-8.5-3.809-8.5-8.5v-30c0-4.691 3.809-8.5 8.5-8.5s8.5 3.809 8.5 8.5z\"/></defs></svg>",
			"order": 8,
			"linkType": "scheme"
		},
		"shortcuts": {
			"name": "shortcuts",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\" viewBox=\"0 0 128 128\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M128 29.835v68.33C128 114.632 114.632 128 98.165 128h-68.33C13.368 128 0 114.632 0 98.165v-68.33C0 13.368 13.368 0 29.835 0h68.33C114.632 0 128 13.368 128 29.835z\" fill=\"#3e4072\"/><clipPath id=\"A\"><path d=\"M99.381 39.95c2.185 1.702 4.105 4.446 4.444 7.246.314 2.595-.665 5.063-2.263 7.078-.509.633-1.069 1.223-1.676 1.763-1.207 1.072-24.578 19.48-26.044 20.28-4.519 2.94-8.783 3.846-14.104 2.72-.2-.042-.411-.106-.614-.122l-.419-.251c-5.176-1.861-29.472-20.738-32.484-24.792-1.481-1.994-2.425-4.367-2.025-6.879.72-4.508 4.796-7.378 8.139-9.992 1.414-1.105 21.072-16.854 23.828-18.242 2.558-1.289 5.422-2.087 8.302-2.024 5.805.126 9.861 3.35 14.174 6.782L99.381 39.95z\"/></clipPath><g clip-path=\"url(#A)\"><use href=\"#B\" x=\"24.104\" y=\"16.731\" width=\"80\" height=\"63\"/></g><path d=\"M37.699 64c.89.559 8.208 6.431 14.27 10.644 3.031 2.106 4.781 3.106 6.736 4.02l.419.251c.203.016.414.08.614.122 5.321 1.126 9.585.22 14.104-2.72.706-.385 4.188-3.08 7.741-5.845 3.827-2.978 7.736-6.048 8.331-6.701l.115-.029c1.511 1.577 3.506 2.89 5.244 4.219 3.45 2.703 7.991 5.842 8.579 10.541.301 2.409-.542 4.755-2.02 6.643-2.665 3.405-26.116 21.275-26.951 21.895-4.303 3.139-8.744 4.319-14.056 3.47-1.949-.311-3.905-1.076-5.584-2.111-2.286-1.409-4.377-3.193-6.489-4.848L39.1 95.959l-6.542-5.185c-1.55-1.225-3.836-2.698-4.995-4.294-.507-.367-.975-.913-1.363-1.403-1.519-1.92-2.309-4.125-2.018-6.583.517-4.379 4.5-7.267 7.709-9.79 1.4-1.138 5.478-4.671 5.808-4.704z\" fill=\"url(#C)\"/><defs><image id=\"B\" width=\"80\" height=\"63\" href=\"data:image/png;base64,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\"/><linearGradient id=\"C\" x1=\"24.122\" y1=\"87.26\" x2=\"103.913\" y2=\"87.26\" gradientUnits=\"userSpaceOnUse\"><stop offset=\"0\" stop-color=\"#4cdaaf\" stop-opacity=\".7\"/><stop offset=\"1\" stop-color=\"#178fff\" stop-opacity=\".9\"/></linearGradient></defs></svg>",
			"order": 9,
			"linkType": "scheme"
		},
		"openrouter": {
			"name": "openrouter",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" fill-rule=\"evenodd\" viewBox=\"0 0 24 24\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M16.804 1.957l7.22 4.105v.087L16.73 10.21l.017-2.117-.821-.03c-1.059-.028-1.611.002-2.268.11-1.064.175-2.038.577-3.147 1.352L8.345 11.03l-.68.455-.515.322-.397.234.385.23.53.338 2.701 1.866c1.11.775 2.083 1.177 3.147 1.352l.3.045c.694.091 1.375.094 2.825.033l.022-2.159 7.22 4.105v.087L16.589 22l.014-1.862-.635.022c-1.386.042-2.137.002-3.138-.162-1.694-.28-3.26-.926-4.881-2.059l-2.158-1.5a21.997 21.997 0 0 0-.755-.498l-.467-.28a55.927 55.927 0 0 0-.76-.43C2.908 14.73.563 14.116 0 14.116V9.888l.14.004c.564-.007 2.91-.622 3.809-1.124l1.016-.58.438-.274 2.686-1.853c1.621-1.133 3.186-1.78 4.881-2.059 1.152-.19 1.974-.213 3.814-.138l.02-1.907z\"/></svg>",
			"order": 21,
			"linkType": "url",
			"themeDarkSvgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"#dadada\" fill-rule=\"evenodd\" viewBox=\"0 0 24 24\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M16.804 1.957l7.22 4.105v.087L16.73 10.21l.017-2.117-.821-.03c-1.059-.028-1.611.002-2.268.11-1.064.175-2.038.577-3.147 1.352L8.345 11.03l-.68.455-.515.322-.397.234.385.23.53.338 2.701 1.866c1.11.775 2.083 1.177 3.147 1.352l.3.045c.694.091 1.375.094 2.825.033l.022-2.159 7.22 4.105v.087L16.589 22l.014-1.862-.635.022c-1.386.042-2.137.002-3.138-.162-1.694-.28-3.26-.926-4.881-2.059l-2.158-1.5a21.997 21.997 0 0 0-.755-.498l-.467-.28a55.927 55.927 0 0 0-.76-.43C2.908 14.73.563 14.116 0 14.116V9.888l.14.004c.564-.007 2.91-.622 3.809-1.124l1.016-.58.438-.274 2.686-1.853c1.621-1.133 3.186-1.78 4.881-2.059 1.152-.19 1.974-.213 3.814-.138l.02-1.907z\"/></svg>"
		},
		"siliconflow": {
			"name": "siliconflow",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" viewBox=\"0 0 72 72\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M68.603 18.923H37.546c-1.716 0-3.105 1.388-3.105 3.105v9.315c0 1.716-1.388 3.105-3.105 3.105H3.398c-1.717 0-3.105 1.388-3.105 3.105v12.42c0 1.716 1.388 3.105 3.105 3.105h31.05c1.716 0 3.105-1.389 3.105-3.105v-9.316c0-1.716 1.388-3.104 3.105-3.104h27.945c1.716 0 3.105-1.389 3.105-3.105v-12.42c0-1.717-1.389-3.105-3.105-3.105z\" fill=\"#6e29f5\" fill-rule=\"nonzero\"/></svg>",
			"order": 22,
			"linkType": "url"
		},
		"douyin": {
			"name": "douyin",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" viewBox=\"0 0 100 100\" xmlns:v=\"https://vecta.io/nano\"><image height=\"100\" width=\"100\" href=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAMAAABHPGVmAAAAY1BMVEVHcEwgFCEVDBkVCxgVCxkWDBkaCxkWCxgeCxobExwiCxsk9O4pRlIoCx0pio8uCx7/9PL8prr/GVReDir39PL/1Nr9WIGREzn/MmbGFUU2CyD/f53S9PGV9PAkyshd9O+QT2joNskxAAAACnRSTlMADGKXu+f///8bvhD68wAABjFJREFUeAGd2ol6ozgQBGAfIONDMDa2Cfia93/KFe3yRJWSVrPbuebkT3VLHzGw0Fqu1lVdu81c7j/Upqnrar1aLoq1XVXzsd+AGE3jwlv4jC9c+PfVavvvxHpjJSlwVCl1rNZ5Zrl238KGABGolGnWma6t6k3SaIrlYmfzZupV0mBCu1RwJI0qS51GJsRuZx+J+qmElrFRCaGIHf1TTXhTpSGlYmVdirHD8SMmRf3MQttPxkGGHJshKkLiuZiBShDFshkp42JlWTNBiIbYR5UIxHOplzIQIVhQ5BDHkSzRWLbuZ6scp6DyiqAEsY41Ww7iHJh0DG9vnKTtOp6OZllbEB56rlUenyzJr08dT6deEVLcNlpaTlJIjHcF5PxBLoxQFpQtsIpypMbhQRCCugbEi0JRqrB+44E0hug0QDCCfg3opSpA3PLTLccDkRCKoL5G77EkMopbLdZqaBBNEkWZfKj8XOb1VRlBhoybqmPk120wxMdN47FUi5qD6My5uo4Qm723ys+lNgRiah4s+I7aZXW+DEC8Is0bcUDIQMXHN6LjJFDuh4+S7lizkH2YalVnb7PACOrRaseihm0WHCSUGFCsBIHyPHDHOMrCDChE7LhXipCybw9QPEdhRJuFLCQQQsr+aY5slhjRXkWCF0Tq/NrvZyjaLlESMaxkHIJI3Y2hLIToRNLjmMI7I5zm8dp7jmLMotwsqomTaJ3GYSdIZuwgYmbCWwE5nShJKGsX7XYKIjnmfhURaxghGoRyUIzwHqqM/ClCdCQaxIDAMHJNtstzljiJBOkoSDLJ6euoCA8FCAXxUDjJdAgVBEFOp5sinMQBYYW34aFtn3urJNIjDCOfYkS69RH2qBwyTaMx1K6Pkm6Xp51oQgnpuj4wt0s2CQava0uJ1+vV970ithwCE5zj5QKEh5Jv1yE6/uN+x3eZROaahuBYJZPodqcYr3s4ZHjPI3MWc/phHEdOsmOEgzxBPM4AsogJKO/nj2QSVmAoUUwCx0qSONmLTzQqAgiRwTMRKjOTKEf7NnCoIhKIAGWi6OCtsK4eDOSRuT6AdCu3Gb0ahXYhCTPSLgrSWq+U+KskHSfJLGHvZR7H61fYz1/XYyEJD95nN6PHRKJ1dQsCqpCEGEoiS/jJzbrGRD7JN2EMn+YVQRA2xqEPNQxpJArCc88k8QcKcnsTPU6/05BsF42ElCadpKXla/MY7NyOUgTN0gVM7SLlGR/jZoZ9o3kEQQhJnk8IedFERjtGHgEgQUoIdavHj45ZBO3KB9F20UgsiB3E4qSRwiYhBAotYJtI92EsjiKZIFb6s7Ai6BaCgBGEDBCCUJLnD2RCkD8NOyiiQeDkXp8QcjUEAtK0Py6q/SEkSP71SRsjxw8SSbSRjkCoW6YQ4ngoDSFhDfdEdNYtugYpzZIgIcmGkjQHQo6n3ndxFgtCu9W/jYhghV/94jLUk868t7EjJRi8W0eKIUH0igSGgmNAmSLFciAqujWyEQhVBHGhX5FxPh+/kYMZ3K0hGBECQpNwv5rn/k7Kqz2Y0AaCz/8X7CNPhldEr2wfwlCoXnsUGxZk9HGQnS5fIBwlZGnlollkPOJrwqFb3kr3ISHOFEI8RbGegXkZEZ8IpsT+0MuDNRBqGEZLzv0+A4ZEZ7SoVTJ1IJvaEM6y27mWo1DRqXnS/QGCLtlWgthYziXjOBtDTERByNhUdhldrwz79m+MsYsJaRUQt8YNAVV+F3oVNwshfOZu0MpubTAD5/clS1yuZvQgdFnxXYclbtLAoNPXcMvF+IKBPiFI0ghHrpK3m8D4/uuYmsZMwNjZW+HW2Sq+cUZRLMw0hqsZ3KgbiLEPhJT2KtSWbgGK4v2AqxmBulyOJlgN3W5XikF3M7cun2XXjycqxODtzQQjzbZ8WzbBDP0uWUzAcGu5wex4/KiuHz7QOPSdRuAY6RvMWGB89zd2fDiGn6aON3amU2Q4uiFPUSTLTkoEVP5hDHoMI8c0ZUKQ9f95ECOSzM0I+iCGZnHFZ0rSRYI+UsLTpyzqSGkMngcp8UreFJ3C8ze1GvrAUlxlofzAkj56RQwqLwjh1tvyQ2TMkOOcfYQ3p4IZhYfICo/DlSv3ONw/SYyvORl/3EMAAAAASUVORK5CYII=\"/></svg>",
			"order": 23,
			"linkType": "url"
		},
		"tiktok": {
			"name": "tiktok",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" viewBox=\"0 0 100 100\" xmlns:v=\"https://vecta.io/nano\"><image height=\"100\" width=\"100\" href=\"data:image/png;base64,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\"/></svg>",
			"order": 24,
			"linkType": "url"
		},
		"baidu": {
			"name": "baidu",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"nonzero\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" viewBox=\"0 0 72 72\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M21.293 54.131c-.229.656-.74 2.336-.298 3.799.872 3.282 3.721 3.429 3.721 3.429h4.093V51.353h-4.383c-1.97.587-2.92 2.12-3.133 2.778zm12.2 11.251H23.331c-4.388-.875-6.135-3.869-6.356-4.38-.216-.518-1.462-2.925-.803-7.02 1.896-6.135 7.303-6.575 7.303-6.575h5.409v-6.649l4.607.07v24.554zm18.924-.07H40.724c-4.531-1.168-4.743-4.388-4.743-4.388v-12.93l4.743-.077v11.621c.29 1.24 1.83 1.464 1.83 1.464h4.818V47.994h5.045z\" fill=\"#dadada\"/><path d=\"M12.985 37.881c7.818-1.678 6.753-11.02 6.519-13.062-.383-3.148-4.086-8.65-9.113-8.215-6.327.568-7.251 9.707-7.251 9.707-.856 4.225 2.048 13.251 9.845 11.57zm8.302 16.25c-.229.656-.74 2.336-.298 3.799.872 3.282 3.721 3.429 3.721 3.429h4.093V51.353H24.42c-1.97.587-2.92 2.12-3.133 2.778zm6.207-31.915c4.318 0 7.807-4.969 7.807-11.112C35.301 4.967 31.812 0 27.494 0c-4.311 0-7.809 4.967-7.809 11.104 0 6.143 3.5 11.112 7.809 11.112zm18.596.735c5.77.749 9.481-5.409 10.218-10.077.753-4.661-2.971-10.075-7.056-11.006-4.093-.939-9.204 5.619-9.671 9.894-.556 5.225.748 10.448 6.509 11.189zm14.139 27.437S51.3 43.48 46.088 36.015c-7.065-11.008-17.1-6.528-20.457-.93-3.343 5.597-8.552 9.138-9.292 10.075-.751.923-10.785 6.34-8.556 16.233 2.226 9.887 10.05 9.699 10.05 9.699s5.766.568 12.454-.929c6.691-1.484 12.452.369 12.452.369s15.629 5.234 19.906-4.841-2.416-15.303-2.416-15.303zM33.487 65.382H23.325c-4.388-.875-6.135-3.869-6.356-4.38-.216-.518-1.462-2.925-.803-7.02 1.896-6.135 7.303-6.575 7.303-6.575h5.409v-6.649l4.607.07v24.554zm18.924-.07H40.718c-4.531-1.168-4.743-4.388-4.743-4.388v-12.93l4.743-.077v11.621c.29 1.24 1.83 1.464 1.83 1.464h4.818V47.994h5.045zm16.552-34.523c0-2.233-1.855-8.957-8.734-8.957-6.892 0-7.813 6.346-7.813 10.832 0 4.282.362 10.258 8.922 10.068s7.625-9.698 7.625-11.943z\" fill=\"#3245df\"/></svg>",
			"order": 25,
			"linkType": "url"
		},
		"flomo": {
			"name": "flomo",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"nonzero\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" viewBox=\"0 0 70 70\" fill=\"#30cf79\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M36.323 15.818l.325-.001.354.002.378-.001 1.038.002h1.12l1.939.002 2.805.002 4.549.004 4.42.004h1.642l11.338.01c-.125.32-.258.612-.435.906l-.143.238-.153.251-.158.263-1.102 1.751-1.322 2.121-.83 1.344-.159.257-.996 1.571c-.128.198-.128.198-.21.479-.247.124-.421.109-.697.109h-1.067c-.35 0-.7 0-1.05-.001h-1.131c-.654 0-1.307 0-1.961-.001l-2.834-.001c-1.533 0-3.066-.001-4.599-.002l-4.468-.002h-1.658l-11.462-.005c.114-.35.221-.658.422-.967l.137-.213.148-.227.317-.495.166-.257.774-1.242 1.54-2.475.953-1.545.197-.323.371-.617.171-.279.148-.246c.316-.38.711-.416 1.183-.416zM21.73 30.186l1.457.001 2.517.004 3.639.006 5.905.009 5.732.01h.358l1.777.002 14.708.024-.227.46-.128.259c-.179.346-.388.667-.605.991l-1.256 1.999-1.263 2.041-1.494 2.419-.165.272-.146.243-.321.497a4.9 4.9 0 0 1-.684.035l-.216.001c-.239 0-.479-.001-.719-.003h-.514c-.467 0-.933-.001-1.399-.003l-1.462-.003c-.922 0-1.845-.003-2.768-.006l-3.151-.006-6.483-.015.067.158.306.716.106.247c.288.678.501 1.353.681 2.069l.08.283c.653 2.373.641 5.243.113 7.641l-.082.375c-1.11 4.521-3.901 8.222-7.843 10.643-.774.461-1.567.843-2.416 1.149-.296.105-.296.105-.598.25-.458.198-.939.293-1.425.395l-.3.063c-3.595.743-7.124.32-10.434-1.277l-.184-.088c-3.783-1.842-6.794-5.366-8.174-9.321-.51-1.539-.93-3.046-.939-4.676l-.002-.237-.002-.494-.007-.735c-.01-1.471.16-2.909.586-4.322l.075-.254c.723-2.377 1.953-4.601 3.678-6.397.235-.242.235-.242.436-.501.281-.349.616-.617.957-.905l.244-.218c1.303-1.138 2.799-2.021 4.395-2.682l.194-.08c2.418-.984 4.826-1.053 7.396-1.039m1.688 10.204c-1.365-.723-2.863-.952-4.305-.747a7.63 7.63 0 0 0-3.969 1.851c-.67.633-1.251 1.382-1.672 2.205s-.686 1.728-.717 2.664c-.014 1.072.057 2.144.327 3.148s.738 1.945 1.518 2.749l.217.21c.706.724 1.454 1.28 2.282 1.66s1.73.583 2.752.603l.347.002c.493.005.957-.025 1.414-.098a7.59 7.59 0 0 0 1.371-.355c.887-.443 1.672-.968 2.335-1.615a7.17 7.17 0 0 0 1.6-2.335l.076-.181a6.45 6.45 0 0 0 .438-1.549c.078-.516.092-1.041.06-1.611l-.015-.223c-.055-.868-.237-1.735-.558-2.546s-.779-1.561-1.384-2.202l-.184-.181c-.263-.258-.527-.499-.805-.721a6.71 6.71 0 0 0-.895-.605l-.233-.123z\"/></svg>",
			"order": 26,
			"linkType": "url"
		},
		"wikipedia": {
			"name": "wikipedia",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\" viewBox=\"0 0 72 72\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M72 14.395v43.21C72 65.55 65.55 72 57.605 72h-43.21C6.45 72 0 65.55 0 57.605v-43.21C0 6.45 6.45 0 14.395 0h43.21C65.55 0 72 6.45 72 14.395z\" fill=\"#fff\"/><path d=\"M55.836 18H69v2.586c-3.115 0-5.231 1.411-6.465 4.173L46.961 59.787l-1.763-.646L36.97 41.98l-9.815 17.808-1.704-.646-14.987-34.381c-.294-.764-.705-1.411-1.293-1.998-.646-.529-1.293-.94-1.939-1.234l-1.998-.646s-1.175-.235-1.587-.235L3 20.586V18h17.631v2.586h-.294c-.176 0-.411 0-.823.059s-.705.176-.999.235l-1.058.47s-.705.47-.823.764c-.176.294-.294.705-.353 1.117-.118.411 0 .94.294 1.528l12.048 27.622 7.053-13.165-6.935-14.458c-1.117-2.351-3.056-3.703-5.76-4.114-.294-.059-.411-.059-.411-.059V18h15.281v2.586h-.294c-.118.059-.353.059-.646.118s-.588.176-.882.235c-.294.118-.529.294-.823.47-.294.235-.529.47-.646.764-.176.294-.235.646-.176 1.058 0 .47.118.999.353 1.528l4.232 8.639 4.584-8.639c.411-.764.529-1.469.47-1.998s-.353-.94-.764-1.234-.882-.47-1.352-.646c-.47-.118-.882-.176-1.234-.235l-.588-.059V18h13.459v2.586h-.529l-1.293.294-1.822.588c-.588.294-1.175.705-1.822 1.293s-1.175 1.234-1.587 1.998l-6.112 11.402 7.64 15.633 11.695-27.035c.294-.823.411-1.528.294-2.057-.118-.47-.411-.882-.823-1.234-.47-.294-.94-.47-1.411-.646-.529-.118-.94-.176-1.352-.176l-.588-.059V18z\" fill-rule=\"nonzero\"/></svg>",
			"order": 27,
			"linkType": "url"
		},
		"archive": {
			"name": "archive",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\" viewBox=\"0 0 83 86\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M78.499 82.047V86H3.501l.001-3.953h74.997zm-2.96-5.93v4.942H6.462v-4.942h69.077zM13.695 22.744l.824.417.412 6.665.412 10.831v10.415l-.412 12.984-.068 8.747-1.167.348H9.577l-1.235-.348-.481-8.747-.412-12.915V40.727l.412-10.901.377-6.701.859-.381h4.599zm59.21 0l.824.417.412 6.665.412 10.831v10.415l-.412 12.984-.068 8.747-1.167.348h-4.119l-1.235-.348-.482-8.747-.412-12.915V40.727l.412-10.901.378-6.701.859-.381h4.6zm-41.447 0l.824.417.412 6.665.412 10.831v10.415l-.412 12.984-.067 8.747-1.168.348H27.34l-1.236-.348-.48-8.747-.412-12.915V40.727l.412-10.901.378-6.701.858-.381h4.6zm22.697 0l.824.417.412 6.665.412 10.831v10.415l-.412 12.984-.067 8.747-1.168.348h-4.119l-1.235-.348-.481-8.747-.412-12.915V40.727l.412-10.901.378-6.701.859-.381h4.599zm21.384-8.895v6.919H6.462v-6.919h69.077zM40.289 1l36.236 8.311-1.453 2.561h-69.4L3.501 9.796 40.289 1z\" fill=\"#2c2c2c\"/></svg>",
			"order": 28,
			"linkType": "url",
			"themeDarkSvgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\" viewBox=\"0 0 83 86\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M78.499 82.047V86H3.501l.001-3.953h74.997zm-2.96-5.93v4.942H6.462v-4.942h69.077zM13.695 22.744l.824.417.412 6.665.412 10.831v10.415l-.412 12.984-.068 8.747-1.167.348H9.577l-1.235-.348-.481-8.747-.412-12.915V40.727l.412-10.901.377-6.701.859-.381h4.599zm59.21 0l.824.417.412 6.665.412 10.831v10.415l-.412 12.984-.068 8.747-1.167.348h-4.119l-1.235-.348-.482-8.747-.412-12.915V40.727l.412-10.901.378-6.701.859-.381h4.6zm-41.447 0l.824.417.412 6.665.412 10.831v10.415l-.412 12.984-.067 8.747-1.168.348H27.34l-1.236-.348-.48-8.747-.412-12.915V40.727l.412-10.901.378-6.701.858-.381h4.6zm22.697 0l.824.417.412 6.665.412 10.831v10.415l-.412 12.984-.067 8.747-1.168.348h-4.119l-1.235-.348-.481-8.747-.412-12.915V40.727l.412-10.901.378-6.701.859-.381h4.599zm21.384-8.895v6.919H6.462v-6.919h69.077zM40.289 1l36.236 8.311-1.453 2.561h-69.4L3.501 9.796 40.289 1z\" fill=\"#dadada\"/></svg>"
		},
		"docs.google": {
			"name": "googledocs",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\" viewBox=\"0 0 36 36\" fill-rule=\"nonzero\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M10.875 18.375h14.25V21h-14.25zm0 4.5h10.5V25.5h-10.5z\" fill=\"#fff\"/><path d=\"M21.75 9.75l4.524.855L30 9.75 21.75 1.5l-1.138 3.911L21.75 9.75z\" fill=\"#1967d2\"/><path d=\"M10.875 13.875h14.25V16.5h-14.25z\" fill=\"#fff\"/><path d=\"M21.75 9.75V1.5H8.25A2.25 2.25 0 0 0 6 3.75v28.5a2.25 2.25 0 0 0 2.25 2.25h19.5A2.25 2.25 0 0 0 30 32.25V9.75h-8.25zM21 25.125h-9.75V23.25H21v1.875zm3.75-4.5h-13.5V18.75h13.5v1.875zm0-4.5h-13.5V14.25h13.5v1.875z\" fill=\"#4285f4\"/></svg>",
			"order": 29,
			"linkType": "url"
		},
		"cloud.google": {
			"name": "googlecloud",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\" viewBox=\"0 0 800 800\" fill-rule=\"nonzero\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M532.038 255.684l69.541-69.541 4.634-29.281C479.491 41.634 278.05 54.7 163.813 184.125c-31.728 35.947-55.269 80.763-67.822 127.041l24.906-3.509 139.078-22.937 10.738-10.978c61.866-67.944 166.469-77.084 237.9-19.275l23.425 1.219z\" fill=\"#ea4335\"/><path d=\"M700.641 309.119a313.3 313.3 0 0 0-94.428-152.256l-97.6 97.6a173.6 173.6 0 0 1 63.684 137.616v17.325c47.969 0 86.866 38.891 86.866 86.863s-38.894 85.891-86.866 85.891H398.325L381.244 600.7v104.188l17.081 16.347h173.969c124.781.972 226.728-98.419 227.7-223.2.587-75.559-36.762-146.581-99.353-188.916\" fill=\"#4285f4\"/><path d=\"M224.594 721.238h173.728V582.156H224.594a85.28 85.28 0 0 1-35.622-7.806l-24.647 7.562-70.028 69.541-6.1 23.669c39.272 29.653 87.188 46.328 136.397 46.116\" fill=\"#34a853\"/><path d=\"M224.594 270.078C99.813 270.825-.741 372.588.003 497.372.419 567.003 33 632.672 88.197 675.122l100.775-100.769c-43.719-19.756-63.15-71.206-43.397-114.925s71.206-63.15 114.922-43.4c19.259 8.7 34.697 24.141 43.397 43.4l100.775-100.775a225.85 225.85 0 0 0-180.075-88.575\" fill=\"#fbbc05\"/></svg>",
			"order": 30,
			"linkType": "url"
		},
		"google": {
			"name": "google",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"100%\" viewBox=\"0 0 25 24\" fill-rule=\"evenodd\" stroke-linejoin=\"round\" stroke-miterlimit=\"2\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M.881 0h24v24h-24z\" fill=\"#fff\" fill-opacity=\".01\"/><g fill-rule=\"nonzero\"><path d=\"M23.561 12.25c.001-.755-.067-1.508-.201-2.25H12.942v4.26h5.953a5.07 5.07 0 0 1-2.222 3.31v2.77h3.59c2.092-1.92 3.298-4.74 3.298-8.09z\" fill=\"#4285f4\"/><path d=\"M12.942 23c2.987 0 5.491-.98 7.321-2.66l-3.59-2.77c-.985.66-2.242 1.06-3.731 1.06-2.876 0-5.32-1.93-6.194-4.53h-3.68v2.84c1.82 3.59 5.55 6.06 9.874 6.06z\" fill=\"#34a853\"/><path d=\"M6.748 14.09c-.221-.66-.352-1.36-.352-2.09s.131-1.43.352-2.09V7.07h-3.68C2.313 8.55 1.881 10.22 1.881 12s.432 3.45 1.187 4.93l2.866-2.22.814-.62z\" fill=\"#fbbc05\"/><path d=\"M12.942 5.38c1.629 0 3.077.56 4.234 1.64l3.168-3.15C18.423 2.09 15.929 1 12.942 1 8.618 1 4.888 3.47 3.068 7.07l3.68 2.84c.875-2.6 3.318-4.53 6.194-4.53z\" fill=\"#ea4335\"/></g></svg>",
			"order": 31,
			"linkType": "url"
		},
		"obsidianweb": {
			"name": "obsidianweb",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 256 256\" xmlns:v=\"https://vecta.io/nano\"><style>@media(prefers-color-scheme: dark){.A{fill:#A88BFA}}</style><path d=\"M94.82 149.44c6.53-1.94 17.13-4.9 29.26-5.71a102.97 102.97 0 0 1-7.64-48.84c1.63-16.51 7.54-30.38 13.25-42.1l3.47-7.14 4.48-9.18c2.35-5 4.08-9.38 4.9-13.56.81-4.07.81-7.64-.2-11.11-1.03-3.47-3.07-7.14-7.15-11.21a17.02 17.02 0 0 0-15.8 3.77l-52.81 47.5a17.12 17.12 0 0 0-5.5 10.2l-4.5 30.18a149.26 149.26 0 0 1 38.24 57.2zM54.45 106l-1.02 3.06-27.94 62.2a17.33 17.33 0 0 0 3.27 18.96l43.94 45.16a88.7 88.7 0 0 0 8.97-88.5A139.47 139.47 0 0 0 54.45 106zM82.9 240.79l2.34.2c8.26.2 22.33 1.02 33.64 3.06 9.28 1.73 27.73 6.83 42.82 11.21 11.52 3.47 23.45-5.8 25.08-17.73 1.23-8.67 3.57-18.46 7.75-27.53a94.81 94.81 0 0 0-25.9-40.99 56.48 56.48 0 0 0-29.56-13.35 96.55 96.55 0 0 0-40.99 4.79 98.89 98.89 0 0 1-15.29 80.34h.1zm118.97-43.03a574.87 574.87 0 0 0 19.78-31.6 8.67 8.67 0 0 0-.61-9.48 185.58 185.58 0 0 1-21.82-35.9c-5.91-14.16-6.73-36.08-6.83-46.69 0-4.07-1.22-8.05-3.77-11.21l-34.16-43.33c0 1.94-.4 3.87-.81 5.81a76.42 76.42 0 0 1-5.71 15.9l-4.7 9.8-3.36 6.72a111.95 111.95 0 0 0-12.03 38.23 93.9 93.9 0 0 0 8.67 47.92 67.9 67.9 0 0 1 39.56 16.52 99.4 99.4 0 0 1 25.8 37.31z\" fill=\"#9974f8\"/></svg>",
			"order": 33,
			"linkType": "url"
		},
		"obsidiannote": {
			"name": "obsidiannote",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 512 512\" xmlns:v=\"https://vecta.io/nano\"><radialGradient id=\"A\" cx=\"0\" cy=\"0\" gradientTransform=\"matrix(-59 -225 150 -39 161.4 470)\" gradientUnits=\"userSpaceOnUse\" r=\"1\"><stop offset=\"0\" stop-color=\"#fff\" stop-opacity=\".4\"/><stop offset=\"1\" stop-opacity=\".1\"/></radialGradient><radialGradient id=\"B\" cx=\"0\" cy=\"0\" gradientTransform=\"matrix(50 -379 280 37 360 374.2)\" gradientUnits=\"userSpaceOnUse\" r=\"1\"><stop offset=\"0\" stop-color=\"#fff\" stop-opacity=\".6\"/><stop offset=\"1\" stop-color=\"#fff\" stop-opacity=\".1\"/></radialGradient><radialGradient id=\"C\" cx=\"0\" cy=\"0\" gradientTransform=\"matrix(69 -319 218 47 175.4 307)\" gradientUnits=\"userSpaceOnUse\" r=\"1\"><stop offset=\"0\" stop-color=\"#fff\" stop-opacity=\".8\"/><stop offset=\"1\" stop-color=\"#fff\" stop-opacity=\".4\"/></radialGradient><radialGradient id=\"D\" cx=\"0\" cy=\"0\" gradientTransform=\"matrix(-96 -163 187 -111 335.3 512.2)\" gradientUnits=\"userSpaceOnUse\" r=\"1\"><stop offset=\"0\" stop-color=\"#fff\" stop-opacity=\".3\"/><stop offset=\"1\" stop-opacity=\".3\"/></radialGradient><radialGradient id=\"E\" cx=\"0\" cy=\"0\" gradientTransform=\"matrix(-36 166 -112 -24 310 128.2)\" gradientUnits=\"userSpaceOnUse\" r=\"1\"><stop offset=\"0\" stop-color=\"#fff\" stop-opacity=\"0\"/><stop offset=\"1\" stop-color=\"#fff\" stop-opacity=\".2\"/></radialGradient><radialGradient id=\"F\" cx=\"0\" cy=\"0\" gradientTransform=\"matrix(88 89 -190 187 111 220.2)\" gradientUnits=\"userSpaceOnUse\" r=\"1\"><stop offset=\"0\" stop-color=\"#fff\" stop-opacity=\".2\"/><stop offset=\"1\" stop-color=\"#fff\" stop-opacity=\".4\"/></radialGradient><radialGradient id=\"G\" cx=\"0\" cy=\"0\" gradientTransform=\"matrix(9 130 -276 20 215 284)\" gradientUnits=\"userSpaceOnUse\" r=\"1\"><stop offset=\"0\" stop-color=\"#fff\" stop-opacity=\".2\"/><stop offset=\"1\" stop-color=\"#fff\" stop-opacity=\".3\"/></radialGradient><radialGradient id=\"H\" cx=\"0\" cy=\"0\" gradientTransform=\"matrix(-198 -104 327 -623 400 399.2)\" gradientUnits=\"userSpaceOnUse\" r=\"1\"><stop offset=\"0\" stop-color=\"#fff\" stop-opacity=\".2\"/><stop offset=\".5\" stop-color=\"#fff\" stop-opacity=\".2\"/><stop offset=\"1\" stop-color=\"#fff\" stop-opacity=\".3\"/></radialGradient><clipPath id=\"I\"><path d=\"M.2.2h512v512H.2z\"/></clipPath><g clip-path=\"url(#I)\"><path d=\"M382.3 475.6c-3.1 23.4-26 41.6-48.7 35.3-32.4-8.9-69.9-22.8-103.6-25.4l-51.7-4a34 34 0 0 1-22-10.2l-89-91.7a34 34 0 0 1-6.7-37.7l57.1-127.3c2-6.3 9.6-61.2 14-90.6 1.2-7.9 5-15 11-20.3L248 8.9a34.1 34.1 0 0 1 49.6 4.3L386 125.6a37 37 0 0 1 7.6 22.4c0 21.3 1.8 65 13.6 93.2 11.5 27.3 32.5 57 43.5 71.5a17.3 17.3 0 0 1 1.3 19.2 1494 1494 0 0 1-44.8 70.6c-15 22.3-21.9 49.9-25 73.1z\" fill=\"#6c31e3\"/><path d=\"M165.9 478.3c41.4-84 40.2-144.2 22.6-187-16.2-39.6-46.3-64.5-70-80-.6 2.3-1.3 4.4-2.2 6.5L60.6 342a34 34 0 0 0 6.6 37.7l89.1 91.7a34 34 0 0 0 9.6 7z\" fill=\"url(#A)\"/><path d=\"M278.4 307.8c11.2 1.2 22.2 3.6 32.8 7.6 34 12.7 65 41.2 90.5 96.3 1.8-3.1 3.6-6.2 5.6-9.2a1536 1536 0 0 0 44.8-70.6 17 17 0 0 0-1.3-19.2c-11-14.6-32-44.2-43.5-71.5-11.8-28.2-13.5-72-13.6-93.2 0-8.1-2.6-16-7.6-22.4L297.6 13.2a34 34 0 0 0-1.5-1.7 96 96 0 0 1 2 54 198.3 198.3 0 0 1-17.6 41.3l-7.2 14.2a171 171 0 0 0-19.4 71c-1.2 29.4 4.8 66.4 24.5 115.8z\" fill=\"url(#B)\"/><path d=\"M278.4 307.8c-19.7-49.4-25.8-86.4-24.5-115.9a171 171 0 0 1 19.4-71c2.3-4.8 4.8-9.5 7.2-14.1 7.1-13.9 14-27 17.6-41.4a96 96 0 0 0-2-54A34.1 34.1 0 0 0 248 9l-105.4 94.8a34.1 34.1 0 0 0-10.9 20.3l-12.8 85-.5 2.3c23.8 15.5 54 40.4 70.1 80a147 147 0 0 1 7.8 24.8c28-6.8 55.7-11 82.1-8.3z\" fill=\"url(#C)\"/><path d=\"M333.6 511c22.7 6.2 45.6-12 48.7-35.4a187 187 0 0 1 19.4-63.9c-25.6-55-56.5-83.6-90.4-96.3-36-13.4-75.2-9-115 .7 8.9 40.4 3.6 93.3-30.4 162.2 4 1.8 8.1 3 12.5 3.3l53.6 4.1c29 2 72.4 17.1 101.6 25.2z\" fill=\"url(#D)\"/><g fill-rule=\"evenodd\"><path d=\"M254.1 190c-1.3 29.2 2.4 62.8 22.1 112.1l-6.2-.5c-17.7-51.5-21.5-78-20.2-107.6a174.7 174.7 0 0 1 20.4-72c2.4-4.9 8-14.1 10.5-18.8 7.1-13.7 11.9-21 16-33.6 5.7-17.5 4.5-25.9 3.8-34.1 4.6 29.9-12.7 56-25.7 82.4a177.1 177.1 0 0 0-20.7 72z\" fill=\"url(#E)\"/><path d=\"M194.3 293.4c2.4 5.4 4.6 9.8 6 16.5L195 311c-2.1-7.8-3.8-13.4-6.8-20-17.8-42-46.3-63.6-69.7-79.5 28.2 15.2 57.2 39 75.7 81.9z\" fill=\"url(#F)\"/><path d=\"m200.6 315.1c9.8 46-1.2 104.2-33.6 160.9 27.1-56.2 40.2-110.1 29.3-160z\" fill=\"url(#G)\"/><path d=\"m312.5 311c53.1 19.9 73.6 63.6 88.9 100-19-38.1-45.2-80.3-90.8-96-34.8-11.8-64.1-10.4-114.3 1l-1.1-5c53.2-12.1 81-13.5 117.3 0z\" fill=\"url(#H)\"/></g></g></svg>",
			"order": 34,
			"linkType": "scheme"
		},
		"advanceduri setting": {
			"name": "advancedurisetting",
			"svgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" viewBox=\"0 0 20 22\" fill=\"none\" stroke=\"#000\" stroke-width=\"2\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M7.627 3.119A2.35 2.35 0 0 1 9.956 1a2.35 2.35 0 0 1 2.33 2.119 2.35 2.35 0 0 0 2.331 2.134 2.34 2.34 0 0 0 .988-.219 2.34 2.34 0 0 1 .967-.209 2.35 2.35 0 0 1 2.34 2.34 2.34 2.34 0 0 1-.977 1.902 2.34 2.34 0 0 0-.996 1.915c0 .762.372 1.478.996 1.916a2.34 2.34 0 0 1 .977 1.902 2.35 2.35 0 0 1-2.34 2.34 2.34 2.34 0 0 1-.967-.209 2.34 2.34 0 0 0-.988-.219 2.35 2.35 0 0 0-2.331 2.134 2.35 2.35 0 0 1-2.329 2.119 2.35 2.35 0 0 1-2.33-2.119 2.35 2.35 0 0 0-2.331-2.134c-.342 0-.679.075-.989.219a2.34 2.34 0 0 1-.967.209A2.35 2.35 0 0 1 1 14.8a2.34 2.34 0 0 1 .977-1.902 2.34 2.34 0 0 0 .996-1.915c0-.762-.372-1.478-.996-1.916a2.34 2.34 0 0 1-.976-1.901c0-1.284 1.057-2.34 2.34-2.34a2.34 2.34 0 0 1 .965.208 2.34 2.34 0 0 0 .988.219 2.35 2.35 0 0 0 2.331-2.134\"/><circle cx=\"9.956\" cy=\"10.983\" r=\"3\"/></svg>",
			"order": 33,
			"linkType": "scheme",
			"themeDarkSvgData": "<svg xmlns=\"http://www.w3.org/2000/svg\" fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" viewBox=\"0 0 20 22\" fill=\"none\" stroke=\"#dadada\" stroke-width=\"2\" xmlns:v=\"https://vecta.io/nano\"><path d=\"M7.627 3.119A2.35 2.35 0 0 1 9.956 1a2.35 2.35 0 0 1 2.33 2.119 2.35 2.35 0 0 0 2.331 2.134 2.34 2.34 0 0 0 .988-.219 2.34 2.34 0 0 1 .967-.209 2.35 2.35 0 0 1 2.34 2.34 2.34 2.34 0 0 1-.977 1.902 2.34 2.34 0 0 0-.996 1.915c0 .762.372 1.478.996 1.916a2.34 2.34 0 0 1 .977 1.902 2.35 2.35 0 0 1-2.34 2.34 2.34 2.34 0 0 1-.967-.209 2.34 2.34 0 0 0-.988-.219 2.35 2.35 0 0 0-2.331 2.134 2.35 2.35 0 0 1-2.329 2.119 2.35 2.35 0 0 1-2.33-2.119 2.35 2.35 0 0 0-2.331-2.134c-.342 0-.679.075-.989.219a2.34 2.34 0 0 1-.967.209A2.35 2.35 0 0 1 1 14.8a2.34 2.34 0 0 1 .977-1.902 2.34 2.34 0 0 0 .996-1.915c0-.762-.372-1.478-.996-1.916a2.34 2.34 0 0 1-.976-1.901c0-1.284 1.057-2.34 2.34-2.34a2.34 2.34 0 0 1 .965.208 2.34 2.34 0 0 0 .988.219 2.35 2.35 0 0 0 2.331-2.134\"/><circle cx=\"9.956\" cy=\"10.983\" r=\"3\"/></svg>"


/**
 * 外部链接图标插件主类
 */
export default class ExternalLinksIcon extends Plugin {
	settings!: ExternalLinksIconSettings;
	private styleElement: HTMLStyleElement | null = null;
	private generatedCss: string = '';
	private mutationObserver: MutationObserver | null = null;
	private readonly SCAN_DEBOUNCE_KEY = 'scan-links';
	private observedRoots: Element[] = []; // roots we observe / scan within

	/**
	 * 插件加载
	 */
	async onload(): Promise<void> {
		try {
			await this.loadSettings();
			this.addSettingTab(new ExternalLinksIconSettingTab(this.app, this));
			this.applyIconStyles();
			// Setup a MutationObserver to annotate links dynamically when DOM changes occur
			try {
				this.mutationObserver = new MutationObserver((mutations) => {
				// Ignore mutation batches composed entirely of nodes we added/removed
				// (inline icon spans) to avoid self-triggered re-scans that produce
				// flicker or layout thrash (e.g. <p> re-rendering repeatedly).
				if (this.isOwnMutation(mutations)) return;
				this.scheduleScan();
			});
			// Observe only specific content containers to reduce noisy observations.
			// Common Obsidian view classes: preview/source views and generic view-content.
			const observeSelectors = ['.markdown-preview-view', '.markdown-source-view', '.view-content', '.workspace-leaf-content'];
			const roots = Array.from(document.querySelectorAll(observeSelectors.join(',')));
			if (roots.length) {
				this.observedRoots = roots;
				roots.forEach(r => {
					try { this.mutationObserver!.observe(r, { childList: true, subtree: true }); } catch (e) { /* ignore root observe errors */ }
				});
				// Also observe body class changes (theme/layout toggles)
				try { this.mutationObserver!.observe(document.body, { attributes: true, attributeFilter: ['class'] }); } catch (e) { /* ignore */ }
			} else {
				// Fallback: observe body but avoid observing attributes broadly to reduce noise.
				this.observedRoots = [];
				try { this.mutationObserver!.observe(document.body, { childList: true, subtree: true }); } catch (e) { /* ignore */ }
			}
			// Watch workspace events for leaf/layout changes to trigger scans reliably
			this.registerEvent(this.app.workspace.on('active-leaf-change', () => this.scheduleScan()));
			this.registerEvent(this.app.workspace.on('layout-change', () => this.scheduleScan()));

				this.scheduleScan();
			} catch (e) {
				// If DOM isn't ready or observation isn't allowed, fallback to a one-off scan
				this.scanAndAnnotateLinks();
			}
		} catch (error) {
			console.error('External Links Icon plugin failed to load:', error);
		}
	}

	/**
	 * 插件卸载
	 */
	onunload(): void {
		this.removeIconStyles();
	}

	/**
	 * 加载设置
	 */
	async loadSettings(): Promise<void> {
		this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
		this.validateAndFixSettings();
	}

	/**
	 * 验证和修复设置
	 */
	private validateAndFixSettings(): void {
		let order = 0;
		for (const key in this.settings.customIcons) {
			if (Object.prototype.hasOwnProperty.call(this.settings.customIcons, key)) {
				const icon = this.settings.customIcons[key];
				
				// 修复缺失的 order 属性
				if (typeof icon.order !== 'number') {
					icon.order = order++;
				}
				
				// 修复缺失的 linkType 属性
				if (!icon.linkType) {
					icon.linkType = 'url';
				}
				
				// 验证 SVG 数据
				if (!icon.svgData || !this.isValidSvgData(icon.svgData)) {
					icon.svgData = this.getDefaultSvgData();
				}
			}
		}
	}

	/**
	 * 验证 SVG 数据是否有效
	 */
	private isValidSvgData(svgData: string): boolean {
		return svgData.trim().startsWith('<svg') || svgData.startsWith('data:image/svg+xml');
	}

	/**
	 * 获取默认 SVG 数据
	 */
	getDefaultSvgData(): string {
		return '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="currentColor"/></svg>';
	}

	/**
	 * 保存设置
	 */
	async saveSettings(): Promise<void> {
		try {
			await this.saveData(this.settings);
			this.applyIconStyles();
		} catch (error) {
			console.error('Failed to save settings:', error);
		}
	}

	/**
	 * 移除图标样式
	 */
	private removeIconStyles(): void {
		// Do not remove or manage a runtime <style> element. Generated CSS is
		// stored in memory and can be used by a future implementation that avoids
		// creating DOM style nodes.
		this.generatedCss = '';
		// Remove any inserted inline icon elements
		document.querySelectorAll('.external-links-icon-inline').forEach(el => el.remove());
		if (this.mutationObserver) {
			this.mutationObserver.disconnect();
			this.mutationObserver = null;
		}
	}

	/**
	 * 应用图标样式
	 */
	private applyIconStyles(): void {
		// Avoid creating and appending <style> elements at runtime. For now we
		// generate CSS into a string that can be reviewed or used by a future
		// mechanism that does not rely on inserting DOM style nodes.
		this.generatedCss = this.generateCSS();
		// After settings or icons change, re-scan the document and inject per-link
		// inline icon elements (this avoids creating a <style> element with
		// per-icon background rules at runtime).
		this.scheduleScan();
	}

	/**
	 * 生成完整的 CSS 内容
	 */
	private generateCSS(): string {
		const cssRules: string[] = [];
		
		// 添加基础样式
		cssRules.push(this.getBaseCSSRules());
		
		// 按顺序生成预定义图标CSS
		const predefinedIcons = this.getSortedIcons(DEFAULT_SETTINGS.icons || {});
		predefinedIcons.forEach(icon => {
			cssRules.push(this.generateIconCSS(icon));
		});
		
		// 按顺序生成自定义图标CSS
		const customIcons = this.getSortedIcons(this.settings.customIcons || {});
		customIcons.forEach(icon => {
			cssRules.push(this.generateIconCSS(icon));
		});
		
		return cssRules.filter(rule => rule.trim()).join('\n');
	}

	/**
	 * 获取基础 CSS 规则
	 */
	private getBaseCSSRules(): string {
		// The global `body .external-link::after` rule has been removed so that
		// only links with an associated icon receive the pseudo-element. The
		// per-icon generator emits the ::after base rules next to each matching
		// selector in `generateSingleThemeCSS` / `generateThemeSpecificCSS`.
		return '';
	}

	/**
	 * 获取按顺序排列的图标列表
	 */
	private getSortedIcons(icons: Record<string, IconItem>): IconItem[] {
		return Object.values(icons).sort((a, b) => (a.order || 0) - (b.order || 0));
	}

	/**
	 * 为单个图标生成 CSS 规则
	 */
	private generateIconCSS(icon: IconItem): string {
		try {
			const encodedSvg = this.encodeSvgData(icon.svgData);
			
			// 处理深色主题图标
			if (icon.themeDarkSvgData) {
				return this.generateThemeSpecificCSS(icon, encodedSvg);
			}
			
			return this.generateSingleThemeCSS(icon, encodedSvg);
		} catch (error) {
			console.warn(`Failed to generate CSS for icon '${icon.name}':`, error);
			return '';
		}
	}

	/**
	 * 生成支持主题切换的 CSS
	 */
	private generateThemeSpecificCSS(icon: IconItem, lightEncodedSvg: string): string {
		try {
			const darkEncodedSvg = icon.themeDarkSvgData ? this.encodeSvgData(icon.themeDarkSvgData) : undefined;
			const selector = this.getIconSelector(icon);

			// Also emit rules to remove the default background/padding on matched links
			// so the icon can replace the link suffix. These are emitted per-selector
			// rather than globally to preserve Obsidian defaults for non-matching links.
			const baseAfter = `content: " "; display: inline-block; width: ${CSS_CONSTANTS.ICON_SIZE}; height: ${CSS_CONSTANTS.ICON_SIZE}; margin-left: ${CSS_CONSTANTS.ICON_MARGIN}; background-size: contain; background-repeat: no-repeat; background-position: center; vertical-align: middle;`;

			// Helper: if a selector already targets the <body> (e.g. starts with "body.")
			// we should merge the theme class into that same body selector (so that
			// we end up with `body.theme-light.fancy-...` instead of
			// `body.theme-light body.fancy-...`). Support comma-separated selectors.
			const wrapWithTheme = (sel: string, themeClass: string) => {
				return sel.split(',').map(s => {
					s = s.trim();
					if (/^body\b/.test(s)) {
						return s.replace(/^body\b/, `body.${themeClass}`);
					}
					return `body.${themeClass} ${s}`;
				}).join(', ');
			};

			const lightSelector = wrapWithTheme(selector, 'theme-light');
			const darkSelector = wrapWithTheme(selector, 'theme-dark');

			return `
				${lightSelector} { background: none; padding-right: 0; }
				${darkSelector} { background: none; padding-right: 0; }
				${lightSelector}::after { ${baseAfter} background-image: url("${lightEncodedSvg}"); }
				${darkSelector}::after { ${baseAfter} background-image: url("${darkEncodedSvg}"); }
			`;
		} catch (error) {
			console.warn(`Failed to generate theme-specific CSS for icon '${icon.name}':`, error);
			return this.generateSingleThemeCSS(icon, lightEncodedSvg);
		}
	}

	/**
	 * 生成单主题 CSS
	 */
	private generateSingleThemeCSS(icon: IconItem, encodedSvg: string): string {
		const selector = this.getIconSelector(icon).trim();
		// Emit per-selector padding/background removal so only matched links lose
		// the default suffix. Also emit the full ::after base rules so only
		// matched selectors receive the pseudo-element (and its sizing).
		const baseAfter = `content: " "; display: inline-block; width: ${CSS_CONSTANTS.ICON_SIZE}; height: ${CSS_CONSTANTS.ICON_SIZE}; margin-left: ${CSS_CONSTANTS.ICON_MARGIN}; background-size: contain; background-repeat: no-repeat; background-position: center; vertical-align: middle;`;

		// If the selector contains commas, emit rules for each part cleanly.
		const parts = selector.split(',').map(s => s.trim()).filter(Boolean);
		const rules: string[] = [];
		for (const p of parts) {
			rules.push(`${p} { background: none; padding-right: 0; }`);
			rules.push(`${p}::after { ${baseAfter} background-image: url("${encodedSvg}"); }`);
		}
		return rules.join('\n');
	}

	/**
	 * Determine whether the provided MutationRecords are only changes created
	 * by this plugin (adding/removing our `.external-links-icon-inline` nodes).
	 * If so, the observer can safely ignore them to avoid infinite scan loops.
	 */
	private isOwnMutation(mutations: MutationRecord[]): boolean {
		for (const m of mutations) {
			if (m.type === 'childList') {
				for (const n of Array.from(m.addedNodes)) {
					if (n.nodeType !== Node.ELEMENT_NODE) return false;
					const el = n as Element;
					// If the added node is our inline icon (or contains one), treat as own
					if (el.matches && (el.matches('.external-links-icon-inline') || el.querySelector('.external-links-icon-inline'))) {
						continue;
					}
					// Any other added node => not our own mutation
					return false;
				}
				for (const n of Array.from(m.removedNodes)) {
					if (n.nodeType !== Node.ELEMENT_NODE) return false;
					const el = n as Element;
					if (el.matches && (el.matches('.external-links-icon-inline') || el.querySelector('.external-links-icon-inline'))) {
						continue;
					}
					return false;
				}
			} else {
				// attributes or other mutation types: don't ignore (be conservative)
				return false;
			}
		}
		return true;
	}

	/**
	 * Schedule a debounced scan of the document to annotate links with icon
	 * elements. We reuse the existing debounceTimers map to avoid introducing
	 * a new debounce implementation.
	 */
	private scanTimerId: number | null = null;

	private scheduleScan(delay: number = 180): void {
		if (this.scanTimerId) {
			window.clearTimeout(this.scanTimerId);
			this.scanTimerId = null;
		}
		this.scanTimerId = window.setTimeout(() => {
			this.scanTimerId = null;
			this.scanAndAnnotateLinks();
		}, delay);
	}

	/**
	 * Scan the document and annotate matching links with an inline icon
	 * element (a <span><img/></span>). This avoids runtime style injection by
	 * attaching actual elements with data-uris for SVG.
	 */
	private scanAndAnnotateLinks(): void {
		try {
			// Remove any previous inline icon elements and rebuild fresh.
			document.querySelectorAll('.external-links-icon-inline').forEach(el => el.remove());
			// Remove any suffix-hiding class previously added to links
			document.querySelectorAll('.external-link.external-links-icon-hide-suffix').forEach(el => el.classList.remove('external-links-icon-hide-suffix'));

			// Combine built-in and custom icons in order
			const applied = new Set<Element>();
			const icons = this.getSortedIcons(DEFAULT_SETTINGS.icons || {}).concat(this.getSortedIcons(this.settings.customIcons || {}));

			// If there are no icons configured anywhere (unlikely), skip scanning.
			if (!icons.length) return;

			for (const icon of icons) {
				const selector = this.getIconSelector(icon).trim();
				if (!selector) continue;
				// If we have specific roots observed, scope the query inside them; otherwise query document-wide
				const rootSources = (this.observedRoots && this.observedRoots.length) ? this.observedRoots : [document];
				for (const root of rootSources) {
					let elements: NodeListOf<Element> = (root === document ? document.querySelectorAll(selector) : (root as Element).querySelectorAll(selector));
					if (!elements || elements.length === 0) continue;
					for (const el of Array.from(elements)) {
						if (applied.has(el)) continue; // earlier icon takes precedence
						if (!(el instanceof HTMLElement)) continue;
						// create icon span
						const span = document.createElement('span');
						span.className = 'external-links-icon-inline';
						span.setAttribute('data-icon', icon.name);

						// prepare SVG for current link container (respect theme)
						const svgSource = (preferDarkThemeFromDocument() && icon.themeDarkSvgData) ? icon.themeDarkSvgData : icon.svgData || '';
						const prepared = prepareSvgForSettings(svgSource, el as HTMLElement);
						const img = document.createElement('img');
						// Decorative image: hide from assistive tech and avoid focusability
						img.alt = '';
						img.setAttribute('aria-hidden', 'true');
						img.setAttribute('role', 'presentation');
						img.setAttribute('focusable', 'false');
						img.src = `data:image/svg+xml;utf8,${encodeURIComponent(prepared)}`;
						span.appendChild(img);
						span.setAttribute('aria-hidden', 'true');
						span.setAttribute('role', 'presentation');
						span.tabIndex = -1;

						// Prefer inserting the icon as a sibling immediately after the link
					// so link internals are not mutated and click areas remain stable.
					try {
						(el as HTMLElement).insertAdjacentElement('afterend', span);
						// If this icon is a URL scheme (built-in or custom), hide the default suffix on the link
						if (icon.linkType === 'scheme') {
							const isBuiltInScheme = Boolean((DEFAULT_SETTINGS.icons || {})[icon.name]);
							const isCustomScheme = Boolean(this.settings?.customIcons?.[icon.name]);
							if (isBuiltInScheme || isCustomScheme) {
								(el as HTMLElement).classList.add('external-links-icon-hide-suffix');
							}
						}
					} catch (e) {
						// Fallback: append inside link (older behavior)
						try { (el as HTMLElement).appendChild(span); } catch (e2) { continue; }
					}

					applied.add(el);
					}
				}
			}
		} catch (e) {
			console.error('Failed to scan and annotate links for icons:', e);
		}
	}

	/**
	 * 获取图标的 CSS 选择器
	 */
	private getIconSelector(icon: IconItem): string {
		// Special icons (advanced handling via predefined selectors) should
		// take precedence over generic scheme matching so that advanced-uri
		// selectors (which target specific query params) are favored.
		if (this.isSpecialIcon(icon.name)) {
			// Return the stored selector but strip any trailing `:after` markers
			// because the per-icon generator will attach ::after itself.
			return ICON_CATEGORIES.SPECIAL[icon.name].selector.replace(/:?:after/g, '');
		}

		// URL Scheme 类型 - 使用 target 作为 scheme 标识符
		if (icon.linkType === 'scheme') {
			const scheme = icon.target || icon.name;
			return `${CSS_SELECTORS.URL_SCHEME}[href^="${scheme}://"]`;
		}

		// Web 图标 - 检查是否为特殊 Web 图标
		// 先检查 SPECIAL 配置，如果存在则使用特殊选择器
		if (this.isSpecialWebIcon(icon.name)) {
			return ICON_CATEGORIES.SPECIAL[icon.name].selector.replace(/:?:after/g, '');
		}

		// Web 图标 - 预定义的映射
		const domain = this.getWebDomain(icon.name);
		if (domain) {
			return `${CSS_SELECTORS.WEB_LINK}[href*="${domain}"]`;
		}

		// URL 类型的自定义图标 - 使用 target 作为域名匹配
		if (icon.linkType === 'url') {
			const domain = icon.target || icon.name;
			return `${CSS_SELECTORS.WEB_LINK}[href*="${domain}"]`;
		}

		// URL Scheme 图标（兼容遗留）- 但只针对未明确指定 linkType 的情况
		if (this.isUrlSchemeIcon(icon.name) && !icon.linkType) {
			const scheme = icon.target || icon.name;
			return `${CSS_SELECTORS.URL_SCHEME}[href^="${scheme}://"]`;
		}

		// 兜底：自定义数据属性
		return `${CSS_SELECTORS.CUSTOM_DATA}[data-icon="${icon.name}"]`;
	}

	/**
	 * 检查是否为特殊图标
	 */
	private isSpecialIcon(iconName: string): iconName is keyof typeof ICON_CATEGORIES.SPECIAL {
		return iconName in ICON_CATEGORIES.SPECIAL;
	}

	/**
	 * 检查是否为特殊 Web 图标
	 */
	private isSpecialWebIcon(iconName: string): boolean {
		// 检查是否在 SPECIAL 配置中且不是 URL Scheme
		return iconName in ICON_CATEGORIES.SPECIAL && !ICON_CATEGORIES.URL_SCHEME.includes(String(iconName));
	}

	/**
	 * 检查是否为 URL Scheme 图标
	 */
	private isUrlSchemeIcon(iconName: string): boolean {
	return ICON_CATEGORIES.URL_SCHEME.includes(String(iconName));
	}

	/**
	 * 获取 Web 图标的域名
	 */
	private getWebDomain(iconName: string): string | undefined {
		return ICON_CATEGORIES.WEB[iconName as keyof typeof ICON_CATEGORIES.WEB];
	}

	/**
	 * 编码 SVG 数据为数据 URL
	 */
	private encodeSvgData(svgData: string): string {
		if (!svgData) {
			throw new Error('SVG data is empty');
		}

		// 已经是数据 URL
		if (svgData.startsWith('data:image/svg+xml')) {
			return svgData;
		}
		
		// SVG 标签
		if (svgData.trim().startsWith('<svg')) {
			try {
				return `data:image/svg+xml,${encodeURIComponent(svgData.trim())}`;
			} catch (error) {
				console.warn('Failed to encode SVG data:', error);
				throw new Error('Invalid SVG data format');
			}
		}
		
		// 不支持的格式
		throw new Error(`Unsupported SVG data format: ${svgData.substring(0, 50)}...`);
	}
}

/**
 * 外部链接图标设置面板
 */
class ExternalLinksIconSettingTab extends PluginSettingTab {
	plugin: ExternalLinksIcon;
	private debounceTimers: Map<string, number> = new Map();

	constructor(app: App, plugin: ExternalLinksIcon) {
		super(app, plugin);
		this.plugin = plugin;
	}



	/**
	 * 显示设置界面
	 */
	display(): void {
		const { containerEl } = this;
		containerEl.empty();

		// 主标题
		containerEl.createEl('h2', { text: 'External Links Icon Settings' });

		// 第一板块：Add new icon（标题 + 右侧按钮）和说明
		this.createAddIconButton(containerEl);
		containerEl.createEl('div', { text: 'Add website or URL scheme icon. Name must be unique.' });

		// 第二板块：WebSite
		this.displayWebsiteSection(containerEl);

		// 第三板块：URL Scheme
		this.displayURLSchemeSection(containerEl);
	}

	/**
	 * 显示 Website 类型图标区域
	 */
	private displayWebsiteSection(containerEl: HTMLElement): void {
		containerEl.createEl('h3', { text: 'WebSite' });
		containerEl.createEl('div', { text: 'WebSite icons are matched by domain. When adding a website-type icon, provide a unique name and the domain (e.g. "baidu.com").' });
		

	// 内置 Website 图标（只读，默认折叠）
	const builtInWrap = containerEl.createDiv({ cls: 'website-builtins' });
	const builtinsDetails = builtInWrap.createEl('details', { cls: 'builtin-list' });
	builtinsDetails.createEl('summary', { text: 'Built-in' });
	const builtinRow = builtinsDetails.createDiv({ cls: 'builtin-row' });


		// Render built-in website icons from DEFAULT_SETTINGS only (built-ins are read-only in Settings)
		// This ensures Settings preview matches official built-in variants and is not affected by user overrides.
		const builtinIconsMap: Record<string, IconItem> = Object.assign({}, DEFAULT_SETTINGS.icons || {});
		const builtinIcons = Object.values(builtinIconsMap)
			.sort((a: IconItem, b: IconItem) => (a.order || 0) - (b.order || 0))
			.filter((ic: IconItem) => ic.linkType === 'url');
		builtinIcons.forEach((icon: IconItem) => {
			const box = builtinRow.createDiv({ cls: 'website-item' });

			const iconEl = box.createDiv({ cls: 'item-icon' });
			try {
				// Prefer explicit document theme: when document indicates light, always use svgData;
				// when document indicates dark, prefer themeDarkSvgData if available.
				const preferDark = preferDarkThemeFromDocument();
				let svgSource: string;
				if (!preferDark) {
					svgSource = icon.svgData || icon.themeDarkSvgData || '';
				} else {
					svgSource = icon.themeDarkSvgData || icon.svgData || '';
				}
				const img = document.createElement('img');
				const prepared = prepareSvgForSettings(svgSource, iconEl);
				img.src = `data:image/svg+xml;utf8,${encodeURIComponent(prepared)}`;
				img.alt = icon.name || '';
				iconEl.appendChild(img);
			} catch (e) {
				console.warn('Failed to render builtin website preview', e);
				iconEl.textContent = '🔗';
			}

			box.createSpan({ text: icon.name });
		});

		// 自定义 Website 图标（可编辑）
		const customIcons = this.getSortedCustomIcons().filter(ic => ic.linkType === 'url');
		if (customIcons.length > 0) {
			const customWrap = containerEl.createDiv({ cls: 'website-custom' });
			customWrap.createEl('h4', { text: 'Custom' });
			customIcons.forEach((icon, idx) => {
				this.createIconSetting(customWrap, icon, idx);
			});
		} else {
			containerEl.createEl('div', { text: 'No custom website icons yet.' });
		}
	}

	/**
	 * 显示 URL Scheme 说明区域
	 */
	private displayURLSchemeSection(containerEl: HTMLElement): void {
		containerEl.createEl('h3', { text: 'URL Scheme' });
		containerEl.createEl('div', { text: 'URL Scheme icons are matched by a scheme identifier. When adding a scheme-type icon, provide a unique name and the scheme identifier (e.g. "zotero").' });

	// Built-in scheme icons (read-only, default collapsed)
	const builtInWrap = containerEl.createDiv({ cls: 'scheme-builtins' });
	const builtinsDetails = builtInWrap.createEl('details', { cls: 'builtin-list' });
	builtinsDetails.createEl('summary', { text: 'Built-in' });
	const builtinRow = builtinsDetails.createDiv({ cls: 'builtin-row' });


		// For built-in scheme icons use DEFAULT_SETTINGS first (built-ins are read-only in Settings)
		(ICON_CATEGORIES.URL_SCHEME || []).forEach(key => {
			const icon = (DEFAULT_SETTINGS.icons || {})[key] || (this.plugin.settings.icons || {})[key];
			if (icon) {
				const box = builtinRow.createDiv({ cls: 'scheme-item' });

				const iconEl = box.createDiv({ cls: 'item-icon' });
				try {
					const preferDark = preferDarkThemeFromDocument();
					// Explicitly prefer the light `svgData` when the document indicates light theme
					// to avoid accidentally showing a dark variant in the Settings preview.
					let svgSource: string;
					if (!preferDark) {
						svgSource = icon.svgData || icon.themeDarkSvgData || '';
					} else {
						svgSource = icon.themeDarkSvgData || icon.svgData || '';
					}
					const img = document.createElement('img');
					const prepared = prepareSvgForSettings(svgSource, iconEl);
					img.src = `data:image/svg+xml;utf8,${encodeURIComponent(prepared)}`;
					img.alt = icon.name || '';

					iconEl.appendChild(img);
				} catch (e) {
					console.warn('Failed to render builtin scheme preview', e);
					iconEl.textContent = '🔗';
				}
				box.createSpan({ text: icon.name + (icon.target ? ` — ${icon.target}` : '') });
			}
		});

		// Custom scheme icons (editable)
		const customSchemeIcons = this.getSortedCustomIcons().filter(ic => ic.linkType === 'scheme');
		if (customSchemeIcons.length > 0) {
			const customWrap = containerEl.createDiv({ cls: 'scheme-custom' });
			customWrap.createEl('h4', { text: 'Custom' });
			customSchemeIcons.forEach((icon, idx) => {
				this.createIconSetting(customWrap, icon, idx);
			});
		} else {
			containerEl.createEl('div', { text: 'No custom URL Scheme icons yet.' });
		}
	}

	/**
	 * 创建添加图标按钮
	 */
	private createAddIconButton(containerEl: HTMLElement): void {
		const s = new Setting(containerEl).setName('Add new icon').setHeading();
		const btnContainer = s.controlEl.createDiv({ cls: 'add-buttons' });

		const addWebsiteBtn = document.createElement('button');
		addWebsiteBtn.textContent = 'Add Website';
		addWebsiteBtn.onclick = () => {
			const modal = new NewIconModal(this.app, (data: { linkType: LinkType; name: string; target: string; svgData?: string }) => this.addIconWithData(data), 'url');
			modal.open();
		};
		btnContainer.appendChild(addWebsiteBtn);

		const addSchemeBtn = document.createElement('button');
		addSchemeBtn.textContent = 'Add URL Scheme';
		addSchemeBtn.onclick = () => {
			const modal = new NewIconModal(this.app, (data: { linkType: LinkType; name: string; target: string; svgData?: string }) => this.addIconWithData(data), 'scheme');
			modal.open();
		};
		btnContainer.appendChild(addSchemeBtn);
	}

	/**
	 * 根据弹窗数据添加新图标（带校验）
	 */
	private async addIconWithData(data: { linkType: LinkType; name: string; target: string; svgData?: string }) {
		const { linkType, name, target, svgData } = data;
		const customIcons = this.plugin.settings.customIcons || {};
		if (customIcons[name]) {
				new Notice(`Icon name "${name}" already exists. Please choose a unique name.`);
		}

		// 规范化 target：如果是 url，去掉协议和尾部斜杠
		let normalized = target.trim();
		if (linkType === 'url') {
			normalized = normalized.replace(/^https?:\/\//i, '').replace(/\/$/, '');
		}

		// 计算 order
		const maxOrder = Object.values(customIcons).reduce((max, ic) => Math.max(max, ic.order || 0), -1);

		customIcons[name] = {
			name,
			svgData: (svgData && svgData.trim().length > 0) ? svgData : this.plugin.getDefaultSvgData(),
			order: maxOrder + 1,
			linkType,
			target: normalized
		};

		this.plugin.settings.customIcons = customIcons;
		await this.plugin.saveSettings();
		this.display();
	}

	/**
	 * 显示图标列表
	 */
	private displayIconList(containerEl: HTMLElement): void {
		// 清除旧的图标列表
		containerEl.querySelectorAll('.icon-setting-item').forEach(el => el.remove());

		// 显示自定义图标
		const sortedCustomIcons = this.getSortedCustomIcons();
		sortedCustomIcons.forEach((icon, index) => {
			this.createIconSetting(containerEl, icon, index);
		});
	}

	/**
	 * 获取按顺序排列的自定义图标
	 */
	private getSortedCustomIcons(): IconItem[] {
		return Object.values(this.plugin.settings.customIcons || {})
			.sort((a, b) => (a.order || 0) - (b.order || 0));
	}

	/**
	 * 创建单个图标设置项
	 */
	private createIconSetting(containerEl: HTMLElement, icon: IconItem, index: number): void {
		const settingItem = new Setting(containerEl).setClass('icon-setting-item');

		// SVG 预览和名称
		this.addIconPreview(settingItem, icon);
		
		// 图标名称输入
		this.addNameInput(settingItem, icon);
		
		
		// 文件上传按钮
		this.addUploadButton(settingItem, icon);
		
		// 移动和删除按钮
		this.addControlButtons(settingItem, icon, index);
	}

	/**
	 * 添加图标预览
	 */
	private addIconPreview(settingItem: Setting, icon: IconItem): void {
		const previewContainer = settingItem.nameEl.createDiv({ cls: 'svg-preview-container' });

		const previewIcon = previewContainer.createDiv({ cls: 'external-links-icon-preview-div small' });

		// If this icon is a built-in, prefer the DEFAULT_SETTINGS version for Settings preview
		const builtinOverride = (DEFAULT_SETTINGS.icons || {})[icon.name];
		const effectiveIcon = builtinOverride ? builtinOverride : icon;

		// Prefer theme-specific dark svg if document indicates dark theme.
		// Explicitly prefer the light `svgData` when the document indicates light theme to avoid
		// accidentally selecting a dark variant when the Settings page is in light mode.
		const preferDark = preferDarkThemeFromDocument();
		let svgToRender: string;
		if (!preferDark) {
			// Document explicitly light: always use svgData (fallback to themeDarkSvgData only if svgData absent)
			svgToRender = effectiveIcon.svgData || effectiveIcon.themeDarkSvgData || '';
		} else {
			// Document dark or system prefers dark: use themeDarkSvgData when available
			svgToRender = effectiveIcon.themeDarkSvgData || effectiveIcon.svgData || '';
		}

		try {
			const prepared = prepareSvgForSettings(svgToRender || effectiveIcon.svgData || '', previewIcon);
			// (diagnostic logging removed)
			// insert as an <img> so that IDs/defs inside the svg won't conflict with page
			const img = document.createElement('img');
			img.src = `data:image/svg+xml;utf8,${encodeURIComponent(prepared)}`;
			img.alt = icon.name || '';
			previewIcon.appendChild(img);
			// no debug badge
		} catch (error) {
			console.warn('Failed to render icon preview:', error);
			previewIcon.textContent = '🔧'; // fallback glyph
		}

		previewContainer.createSpan({ text: icon.name });
	}

	/**
	 * 添加名称输入框
	 */
	private addNameInput(settingItem: Setting, icon: IconItem): void {
		if (icon.linkType === 'url') {
			// Website custom icons: editable target (domain) only
			settingItem.addText(text => {
				text.setPlaceholder('example.com')
					.setValue(icon.target || '')
					.onChange((value) => {
						this.debounceUpdateTarget(icon.name, value);
					});
			});
		} else {
			// Scheme custom icons: only editable scheme identifier (protocol).
			// Icon ID (name) is shown in the preview area and should not be editable here.
			settingItem.addText(text => {
				text.setPlaceholder('scheme (e.g. zotero)')
					.setValue(icon.target || '')
					.onChange((value) => {
						this.debounceUpdateTarget(icon.name, value);
					});
			});
		}
	}

	/**
	 * 防抖动更新 target（域名或 scheme）
	 */
	private debounceUpdateTarget(name: string, newTarget: string): void {
		const timerId = this.debounceTimers.get(`target-${name}`);
		if (timerId) {
			window.clearTimeout(timerId);
		}

		const newTimerId = window.setTimeout(async () => {
			const icons = this.plugin.settings.customIcons || {};
			if (icons[name]) {
				icons[name].target = newTarget.trim();
				await this.plugin.saveSettings();
				this.display();
			}
			this.debounceTimers.delete(`target-${name}`);
		}, 500);
		this.debounceTimers.set(`target-${name}`, newTimerId);
	}

	/**
	 * 防抖动重命名处理
	 */
	private debounceRename(oldName: string, newName: string): void {
		const timerId = this.debounceTimers.get(oldName);
		if (timerId) {
			window.clearTimeout(timerId);
		}
		
		const newTimerId = window.setTimeout(async () => {
			if (newName !== oldName && newName.trim()) {
				await this.renameIcon(oldName, newName.trim());
				this.display();
			}
			this.debounceTimers.delete(oldName);
		}, 500);
		
		this.debounceTimers.set(oldName, newTimerId);
	}

	/**
	 * 添加链接类型下拉框
	 */
	private addLinkTypeDropdown(settingItem: Setting, icon: IconItem): void {
		settingItem.addDropdown(dropdown => dropdown
			.addOption('url', 'Website')
			.addOption('scheme', 'URL Scheme')
			.setValue(icon.linkType || 'url')
			.onChange(async (value: string) => {
				if (value === 'url' || value === 'scheme') {
					icon.linkType = value;
					await this.plugin.saveSettings();
					// 重新显示以更新占位符
					this.display();
				}
			}));
	}

	/**
	 * 添加上传按钮
	 */
	private addUploadButton(settingItem: Setting, icon: IconItem): void {
		settingItem.addButton(button => button
			.setButtonText('Upload SVG')
			.setTooltip('Upload an SVG file')
			.onClick(() => this.uploadSVG(icon)));
	}

	/**
	 * 添加控制按钮（上移、下移、删除）
	 */
	private addControlButtons(settingItem: Setting, icon: IconItem, index: number): void {
		// Compute ordering within the same linkType group so move buttons reflect group boundaries
		const allCustom = Object.values(this.plugin.settings.customIcons || {});
		const groupSorted = allCustom
			.filter(i => i.linkType === icon.linkType)
			.sort((a, b) => (a.order || 0) - (b.order || 0));
		const currentIndex = groupSorted.findIndex(i => i.name === icon.name);
		
		// Always render move up/down buttons but disable them when at edges within the same group
		const canMoveUp = currentIndex > 0;
		const canMoveDown = currentIndex >= 0 && currentIndex < groupSorted.length - 1;
		settingItem.addButton(button => button
			.setButtonText('↑')
			.setTooltip('Move up')
			.setDisabled(!canMoveUp)
			.onClick(async () => {
				if (!canMoveUp) return;
				await this.moveIcon(icon, -1);
				this.display();
			}));

		settingItem.addButton(button => button
			.setButtonText('↓')
			.setTooltip('Move down')
			.setDisabled(!canMoveDown)
			.onClick(async () => {
				if (!canMoveDown) return;
				await this.moveIcon(icon, 1);
				this.display();
			}));
		
		// 删除按钮
		settingItem.addButton(button => button
			.setButtonText('Delete')
			.setWarning()
			.onClick(async () => {
				const modal = new ConfirmModal(this.plugin.app, `Are you sure you want to delete the icon "${icon.name}"?`);
				modal.open();
				const confirmed = await modal.result;
				if (confirmed) {
					delete this.plugin.settings.customIcons[icon.name];
					await this.plugin.saveSettings();
					this.display();
				}
			}));
	}

	/**
	 * 重命名图标
	 */
	private async renameIcon(oldName: string, newName: string): Promise<void> {
		if (!newName || newName === oldName) {
			return;
		}

		const icons = this.plugin.settings.customIcons;
		const iconItem = icons[oldName];
		
		if (!iconItem) {
			console.warn(`Icon "${oldName}" not found`);
			return;
		}

		// 检查是否已存在同名图标
		if (icons[newName]) {
			console.warn(`Icon "${newName}" already exists`);
			return;
		}

		// 执行重命名
		delete icons[oldName];
		iconItem.name = newName;
		icons[newName] = iconItem;
		
		await this.plugin.saveSettings();
	}

	/**
	 * 移动图标位置
	 */
	private async moveIcon(icon: IconItem, direction: number): Promise<void> {
		// Only operate within the same linkType group (url vs scheme)
		const allCustom = Object.values(this.plugin.settings.customIcons || {});
		const group = allCustom.filter(i => i.linkType === icon.linkType).sort((a, b) => (a.order || 0) - (b.order || 0));
		const currentIndex = group.findIndex(i => i.name === icon.name);
		const targetIndex = currentIndex + direction;
		if (currentIndex === -1 || targetIndex < 0 || targetIndex >= group.length) return;

		const arr = group.slice();
		const [moved] = arr.splice(currentIndex, 1);
		arr.splice(targetIndex, 0, moved);

		// reassign orders within this group starting from 0 (but we'll offset to avoid overlap with other group's orders)
		arr.forEach((it, idx) => { it.order = idx; });

		// merge back: preserve other custom icons (from other linkType) and update this group's items
		const newMap: Record<string, IconItem> = {};
		Object.values(this.plugin.settings.customIcons || {}).forEach(it => {
			if (it.linkType !== icon.linkType) {
				newMap[it.name] = it;
			}
		});
		arr.forEach(it => { newMap[it.name] = it; });

		this.plugin.settings.customIcons = newMap;
		// Normalize orders across all custom icons to ensure stable global ordering
		const combined = Object.values(newMap);
		// Keep groups contiguous by linkType: url first, then scheme
		const linkOrder: LinkType[] = ['url', 'scheme'];
		let idx = 0;
		linkOrder.forEach(lt => {
			combined
				.filter(i => i.linkType === lt)
				.sort((a, b) => (a.order || 0) - (b.order || 0))
				.forEach(it => {
					it.order = idx++;
				});
		});
		// rebuild map with normalized orders
		const normalizedMap: Record<string, IconItem> = {};
		combined.forEach(it => { normalizedMap[it.name] = it; });
		this.plugin.settings.customIcons = normalizedMap;
		await this.plugin.saveSettings();
	}

	/**
	 * 上传 SVG 文件
	 */
	private uploadSVG(icon: IconItem): void {
		const input = document.createElement('input');
		input.type = 'file';
		input.accept = '.svg,image/svg+xml';
		input.classList.add('external-links-icon-hidden-input');

		input.onchange = async (event) => {
			try {
				const files = (event.target as HTMLInputElement).files;
				if (!files || files.length === 0) return;

				const file = files[0];
				if (!this.isValidSvgFile(file)) {
					new Notice('Please select a valid SVG file.');
					return;
				}

				const content = await this.readFileAsText(file);
				if (content && this.isValidSvgContent(content)) {
					const sanitized = sanitizeSvg(content);
					icon.svgData = sanitized;
					await this.plugin.saveSettings();
					this.display();
				} else {
					new Notice('Invalid SVG file content.');
				}
			} catch (error) {
				console.error('Failed to upload SVG:', error);
				new Notice('Failed to upload SVG file.');
			}
		};

		document.body.appendChild(input);
		input.click();
		document.body.removeChild(input);
	}

	/**
	 * 验证是否为有效的 SVG 文件
	 */
	private isValidSvgFile(file: File): boolean {
		return file.type === 'image/svg+xml' || file.name.toLowerCase().endsWith('.svg');
	}

	/**
	 * 验证 SVG 内容是否有效
	 */
	private isValidSvgContent(content: string): boolean {
		const trimmed = content.trim();
		return trimmed.startsWith('<svg') && trimmed.includes('</svg>');
	}

	/**
	 * 读取文件为文本
	 */
	private readFileAsText(file: File): Promise<string> {
		return new Promise((resolve, reject) => {
			const reader = new FileReader();
			reader.onload = (e) => {
				const result = e.target?.result as string;
				resolve(result || '');
			};
			reader.onerror = () => reject(new Error('Failed to read file'));
			reader.readAsText(file);
		});
	}

	/**
	 * 添加新图标
	 */
	private async addIcon(): Promise<void> {
		const timestamp = Date.now();
		const newIconName = `new-icon-${timestamp}`;
		const customIcons = this.plugin.settings.customIcons || {};
		
		// 计算新图标的顺序
		const maxOrder = Object.values(customIcons)
			.reduce((max, icon) => Math.max(max, icon.order || 0), -1);

		// 创建新图标
		customIcons[newIconName] = {
			name: newIconName,
			svgData: this.plugin.getDefaultSvgData(),
			order: maxOrder + 1,
			linkType: 'url'
		};

		this.plugin.settings.customIcons = customIcons;
		await this.plugin.saveSettings();
		this.display();
	}

	/**
	 * 清理资源
	 */
	onunload(): void {
		// 清理防抖动定时器
		this.debounceTimers.forEach(timerId => {
			window.clearTimeout(timerId);
		});
		this.debounceTimers.clear();
	}
}

/**
 * 简单确认模态，用于替换 window.confirm
 */
class ConfirmModal extends Modal {
	private _message: string;
	private _resolver: (value: boolean) => void = () => {};
	public result: Promise<boolean>;

	constructor(app: App, message: string) {
		super(app);
		this._message = message;
		this.result = new Promise<boolean>((resolve) => { this._resolver = resolve; });
	}

	onOpen(): void {
		const { contentEl } = this;
		contentEl.empty();
		contentEl.createEl('div', { text: this._message });
		const actions = contentEl.createDiv({ cls: 'external-links-icon-modal-actions' });
		const cancelBtn = actions.createEl('button', { text: 'Cancel', cls: 'external-links-icon-cancel-btn' });
		const okBtn = actions.createEl('button', { text: 'Confirm', cls: 'external-links-icon-add-btn' });
		cancelBtn.onclick = () => { this._resolver(false); this.close(); };
		okBtn.onclick = () => { this._resolver(true); this.close(); };
	}

	onClose(): void {
		// ensure resolver called if modal closed by other means
		this._resolver(false);
		const { contentEl } = this;
		contentEl.empty();
	}
}

/**
 * 新增图标弹窗
 */
class NewIconModal extends Modal {
	onSubmit: (data: { linkType: LinkType; name: string; target: string; svgData?: string }) => void;

	constructor(app: App, onSubmit: (data: { linkType: LinkType; name: string; target: string; svgData?: string }) => void, defaultLinkType?: LinkType) {
		super(app);
		this.onSubmit = onSubmit;
		this._defaultLinkType = defaultLinkType || 'url';
	}

	private _defaultLinkType: LinkType = 'url';

	onOpen(): void {
		const { contentEl } = this;
		contentEl.empty();

		// 直接在 contentEl 上创建模态窗口内容，避免多层嵌套
		contentEl.createEl('h3', { text: 'Add new icon' });
		
		const descEl = contentEl.createEl('div', { text: 'Provide icon information. Name must be unique.', cls: 'external-links-icon-desc' });

		// Icon name input
		const nameInput = contentEl.createEl('input', { cls: 'external-links-icon-modal-input' });
		nameInput.placeholder = 'Icon name (unique)';
		nameInput.type = 'text';

		// Target input
		const targetInput = contentEl.createEl('input', { cls: 'external-links-icon-modal-input' });
		targetInput.placeholder = 'Website (e.g. baidu.com) or scheme (e.g. zotero)';
		targetInput.type = 'text';

		// Upload SVG controls
		let uploadedSvgData: string | undefined;
		const uploadRow = contentEl.createDiv({ cls: 'external-links-icon-upload-row' });

		const uploadBtn = uploadRow.createEl('button', { text: 'Upload SVG' });
		
		const uploadName = uploadRow.createSpan({ text: 'No file chosen' });
		
		const previewDiv = uploadRow.createDiv({ cls: 'external-links-icon-preview-div small' });

		const hiddenInput = document.createElement('input');
		hiddenInput.type = 'file';
		hiddenInput.accept = '.svg,image/svg+xml';
		hiddenInput.classList.add('external-links-icon-hidden-input');
		hiddenInput.onchange = async (ev) => {
			const files = (ev.target as HTMLInputElement).files;
			if (!files || files.length === 0) return;
			const file = files[0];
			// basic validation
			if (!(file.type === 'image/svg+xml' || file.name.toLowerCase().endsWith('.svg'))) {
				new Notice('Please select a valid SVG file.');
				return;
			}
			const reader = new FileReader();
			reader.onload = () => {
				const content = (typeof reader.result === 'string') ? reader.result : '';
				if (content.trim().startsWith('<svg') && content.includes('</svg>')) {
					const sanitized = sanitizeSvg(content);
					uploadedSvgData = sanitized;
					uploadName.textContent = file.name;
					try {
						const prepared = prepareSvgForSettings(sanitized, previewDiv);
						const img = document.createElement('img');
						img.src = `data:image/svg+xml;utf8,${encodeURIComponent(prepared)}`;
						img.alt = file.name;
						
						
						
						
						// Clear preview safely instead of assigning to innerHTML
					while (previewDiv.firstChild) {
						previewDiv.removeChild(previewDiv.firstChild);
					}
						previewDiv.appendChild(img);
					} catch {
						previewDiv.textContent = '';
					}
				} else {
					new Notice('Invalid SVG content');
				}
			};
			reader.onerror = () => new Notice('Failed to read file');
			reader.readAsText(file);
		};
		document.body.appendChild(hiddenInput);

		uploadBtn.onclick = () => hiddenInput.click();

		// set placeholder based on default type
		const defaultType = this._defaultLinkType || 'url';
		targetInput.placeholder = defaultType === 'url' ? 'Domain (e.g. baidu.com or https://baidu.com)' : 'Scheme identifier (e.g. zotero)';

		// Action buttons
		const buttonContainer = contentEl.createDiv({ cls: 'external-links-icon-modal-actions' });

		const cancelBtn = buttonContainer.createEl('button', { text: 'Cancel' });
		cancelBtn.onclick = () => { this.close(); };

		const addBtn = buttonContainer.createEl('button', { text: 'Add icon' });
		addBtn.onclick = () => {
			const name = (nameInput as HTMLInputElement).value.trim();
			let target = (targetInput as HTMLInputElement).value.trim();
			if (!name) { new Notice('Name is required'); return; }
			if (!target) { new Notice('Target is required'); return; }
			// Normalize website target by removing leading protocol and trailing slash
			if (this._defaultLinkType === 'url') {
				target = target.replace(/^https?:\/\//i, '').replace(/\/$/, '');
			}
			this.onSubmit({ linkType: this._defaultLinkType, name, target, svgData: uploadedSvgData });
			this.close();
		};
	}

	onClose(): void {
		const { contentEl } = this;
		contentEl.empty();
	}
}
